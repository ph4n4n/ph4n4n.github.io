<!DOCTYPE html>
<html lang=vi>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Zero to Hero: RESTful API - Thiết kế và xây dựng API chuẩnRESTful API là kiến trúc API phổ biến nhất hiện nay, sử dụng HTTP protocol để tạo ra các web services có thể mở rộng và dễ bảo trì. 1. RESTful">
<meta property="og:type" content="article">
<meta property="og:title" content="Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn">
<meta property="og:url" content="https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/index.html">
<meta property="og:site_name" content="ph4n4n&#39;s code notes &amp; tips">
<meta property="og:description" content="Zero to Hero: RESTful API - Thiết kế và xây dựng API chuẩnRESTful API là kiến trúc API phổ biến nhất hiện nay, sử dụng HTTP protocol để tạo ra các web services có thể mở rộng và dễ bảo trì. 1. RESTful">
<meta property="og:locale" content="vi_VN">
<meta property="article:published_time" content="2025-06-26T09:31:12.000Z">
<meta property="article:modified_time" content="2025-06-27T02:26:36.996Z">
<meta property="article:author" content="ph4n4n">
<meta property="article:tag" content="Node.js">
<meta property="article:tag" content="Backend">
<meta property="article:tag" content="RESTful API">
<meta property="article:tag" content="HTTP">
<meta property="article:tag" content="Web Services">
<meta property="article:tag" content="API Design">
<meta property="article:tag" content="Express.js">
<meta property="article:tag" content="JSON">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- Monaco font override -->
    
<link rel="stylesheet" href="/css/monaco-override.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="ph4n4n&#39;s code notes &amp; tips" type="application/atom+xml" />
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Trang chủ</a></li><!--
     --><!--
       --><li><a href="/about/">Giới thiệu</a></li><!--
     --><!--
       --><li><a href="/archives/">Bài viết</a></li><!--
     --><!--
       --><li><a href="https://github.com/ph4n4n">Dự án</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Bài tiếp theo" href="/2025/06/26/Zero-to-hero-gRPC/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Về đầu trang" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Chia sẻ bài viết" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Bài trước</span>
      <span id="i-next" class="info" style="display:none;">Bài tiếp theo</span>
      <span id="i-top" class="info" style="display:none;">Về đầu trang</span>
      <span id="i-share" class="info" style="display:none;">Chia sẻ bài viết</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&text=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&is_video=false&description=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn&body=Check out this article: https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&name=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&t=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Zero-to-Hero-RESTful-API-Thiet-ke-va-xay-dung-API-chuan"><span class="toc-number">1.</span> <span class="toc-text">Zero to Hero: RESTful API - Thiết kế và xây dựng API chuẩn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-RESTful-API-la-gi"><span class="toc-number">1.1.</span> <span class="toc-text">1. RESTful API là gì?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dac-diem-chinh"><span class="toc-number">1.1.1.</span> <span class="toc-text">Đặc điểm chính:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-Methods"><span class="toc-number">1.1.2.</span> <span class="toc-text">HTTP Methods</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-HTTP-Status-Codes"><span class="toc-number">1.2.</span> <span class="toc-text">2. HTTP Status Codes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2xx-Success"><span class="toc-number">1.2.1.</span> <span class="toc-text">2xx Success</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4xx-Client-Errors"><span class="toc-number">1.2.2.</span> <span class="toc-text">4xx Client Errors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5xx-Server-Errors"><span class="toc-number">1.2.3.</span> <span class="toc-text">5xx Server Errors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-API-Design-Principles"><span class="toc-number">1.3.</span> <span class="toc-text">3. API Design Principles</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#URL-Design"><span class="toc-number">1.3.1.</span> <span class="toc-text">URL Design</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Response-Format"><span class="toc-number">1.3.2.</span> <span class="toc-text">Response Format</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Error-Response"><span class="toc-number">1.3.3.</span> <span class="toc-text">Error Response</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Express-js-RESTful-API"><span class="toc-number">1.4.</span> <span class="toc-text">4. Express.js RESTful API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Setup"><span class="toc-number">1.4.1.</span> <span class="toc-text">Basic Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#User-Routes"><span class="toc-number">1.4.2.</span> <span class="toc-text">User Routes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Authentication-Authorization"><span class="toc-number">1.5.</span> <span class="toc-text">5. Authentication &amp; Authorization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT-Authentication"><span class="toc-number">1.5.1.</span> <span class="toc-text">JWT Authentication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Login-Route"><span class="toc-number">1.5.2.</span> <span class="toc-text">Login Route</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Database-Integration"><span class="toc-number">1.6.</span> <span class="toc-text">6. Database Integration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-voi-Mongoose"><span class="toc-number">1.6.1.</span> <span class="toc-text">MongoDB với Mongoose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Updated-User-Routes-voi-Database"><span class="toc-number">1.6.2.</span> <span class="toc-text">Updated User Routes với Database</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-API-Documentation-voi-Swagger"><span class="toc-number">1.7.</span> <span class="toc-text">7. API Documentation với Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger-Setup"><span class="toc-number">1.7.1.</span> <span class="toc-text">Swagger Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger-Documentation"><span class="toc-number">1.7.2.</span> <span class="toc-text">Swagger Documentation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Testing-voi-Jest"><span class="toc-number">1.8.</span> <span class="toc-text">8. Testing với Jest</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API-Testing"><span class="toc-number">1.8.1.</span> <span class="toc-text">API Testing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Rate-Limiting-Caching"><span class="toc-number">1.9.</span> <span class="toc-text">9. Rate Limiting &amp; Caching</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Advanced-Rate-Limiting"><span class="toc-number">1.9.1.</span> <span class="toc-text">Advanced Rate Limiting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Caching-voi-Redis"><span class="toc-number">1.9.2.</span> <span class="toc-text">Caching với Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Vi-du-thuc-te-E-commerce-API"><span class="toc-number">1.10.</span> <span class="toc-text">10. Ví dụ thực tế: E-commerce API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Best-Practices"><span class="toc-number">1.11.</span> <span class="toc-text">11. Best Practices</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API-Design-Best-Practices"><span class="toc-number">1.11.1.</span> <span class="toc-text">API Design Best Practices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Security-Best-Practices"><span class="toc-number">1.11.2.</span> <span class="toc-text">Security Best Practices</span></a></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">ph4n4n</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-06-26T09:31:12.000Z" class="dt-published" itemprop="datePublished">2025-06-26</time>
        
        (Updated: <time datetime="2025-06-27T02:26:36.996Z" class="dt-updated" itemprop="dateModified">2025-06-27</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Backend/">Backend</a> › <a class="category-link" href="/categories/Backend/API/">API</a> › <a class="category-link" href="/categories/Backend/API/Programming/">Programming</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/API-Design/" rel="tag">API Design</a>, <a class="p-category" href="/tags/Backend/" rel="tag">Backend</a>, <a class="p-category" href="/tags/Express-js/" rel="tag">Express.js</a>, <a class="p-category" href="/tags/HTTP/" rel="tag">HTTP</a>, <a class="p-category" href="/tags/JSON/" rel="tag">JSON</a>, <a class="p-category" href="/tags/Node-js/" rel="tag">Node.js</a>, <a class="p-category" href="/tags/RESTful-API/" rel="tag">RESTful API</a>, <a class="p-category" href="/tags/Web-Services/" rel="tag">Web Services</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Zero-to-Hero-RESTful-API-Thiet-ke-va-xay-dung-API-chuan"><a href="#Zero-to-Hero-RESTful-API-Thiet-ke-va-xay-dung-API-chuan" class="headerlink" title="Zero to Hero: RESTful API - Thiết kế và xây dựng API chuẩn"></a>Zero to Hero: RESTful API - Thiết kế và xây dựng API chuẩn</h1><p>RESTful API là kiến trúc API phổ biến nhất hiện nay, sử dụng HTTP protocol để tạo ra các web services có thể mở rộng và dễ bảo trì.</p>
<h2 id="1-RESTful-API-la-gi"><a href="#1-RESTful-API-la-gi" class="headerlink" title="1. RESTful API là gì?"></a>1. RESTful API là gì?</h2><p>REST (Representational State Transfer) là một kiến trúc phần mềm cho distributed systems, đặc biệt là World Wide Web.</p>
<h3 id="Dac-diem-chinh"><a href="#Dac-diem-chinh" class="headerlink" title="Đặc điểm chính:"></a>Đặc điểm chính:</h3><ul>
<li><strong>Stateless</strong>: Mỗi request độc lập, không lưu trạng thái</li>
<li><strong>Client-Server</strong>: Tách biệt client và server</li>
<li><strong>Cacheable</strong>: Có thể cache responses</li>
<li><strong>Uniform Interface</strong>: Giao diện thống nhất</li>
<li><strong>Layered System</strong>: Hệ thống phân lớp</li>
<li><strong>Code on Demand</strong>: Có thể tải code khi cần</li>
</ul>
<h3 id="HTTP-Methods"><a href="#HTTP-Methods" class="headerlink" title="HTTP Methods"></a>HTTP Methods</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET     /api/users          # Lấy danh sách users</span><br><span class="line">GET     /api/users/123      # Lấy user có id=123</span><br><span class="line">POST    /api/users          # Tạo user mới</span><br><span class="line">PUT     /api/users/123      # Cập nhật toàn bộ user</span><br><span class="line">PATCH   /api/users/123      # Cập nhật một phần user</span><br><span class="line">DELETE  /api/users/123      # Xóa user</span><br></pre></td></tr></table></figure>

<h2 id="2-HTTP-Status-Codes"><a href="#2-HTTP-Status-Codes" class="headerlink" title="2. HTTP Status Codes"></a>2. HTTP Status Codes</h2><h3 id="2xx-Success"><a href="#2xx-Success" class="headerlink" title="2xx Success"></a>2xx Success</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">200 OK                    # Request thành công</span><br><span class="line">201 Created              # Tạo resource thành công</span><br><span class="line">202 Accepted             # Request được chấp nhận</span><br><span class="line">204 No Content           # Thành công nhưng không có content</span><br></pre></td></tr></table></figure>

<h3 id="4xx-Client-Errors"><a href="#4xx-Client-Errors" class="headerlink" title="4xx Client Errors"></a>4xx Client Errors</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">400 Bad Request          # Request không hợp lệ</span><br><span class="line">401 Unauthorized         # Chưa xác thực</span><br><span class="line">403 Forbidden            # Không có quyền truy cập</span><br><span class="line">404 Not Found            # Resource không tồn tại</span><br><span class="line">409 Conflict             # Xung đột dữ liệu</span><br><span class="line">422 Unprocessable Entity # Dữ liệu không thể xử lý</span><br></pre></td></tr></table></figure>

<h3 id="5xx-Server-Errors"><a href="#5xx-Server-Errors" class="headerlink" title="5xx Server Errors"></a>5xx Server Errors</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">500 Internal Server Error # Lỗi server</span><br><span class="line">502 Bad Gateway          # Lỗi gateway</span><br><span class="line">503 Service Unavailable   # Service không khả dụng</span><br></pre></td></tr></table></figure>

<h2 id="3-API-Design-Principles"><a href="#3-API-Design-Principles" class="headerlink" title="3. API Design Principles"></a>3. API Design Principles</h2><h3 id="URL-Design"><a href="#URL-Design" class="headerlink" title="URL Design"></a>URL Design</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ✅ Tốt - RESTful</span><br><span class="line">GET    /api/users</span><br><span class="line">GET    /api/users/123</span><br><span class="line">POST   /api/users</span><br><span class="line">PUT    /api/users/123</span><br><span class="line">DELETE /api/users/123</span><br><span class="line"></span><br><span class="line">GET    /api/users/123/posts</span><br><span class="line">GET    /api/users/123/posts/456</span><br><span class="line"></span><br><span class="line"># ❌ Không tốt - Không RESTful</span><br><span class="line">GET    /api/getUsers</span><br><span class="line">POST   /api/createUser</span><br><span class="line">PUT    /api/updateUser/123</span><br><span class="line">DELETE /api/deleteUser/123</span><br></pre></td></tr></table></figure>

<h3 id="Response-Format"><a href="#Response-Format" class="headerlink" title="Response Format"></a>Response Format</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;john@example.com&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;User retrieved successfully&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-01-27T10:30:00Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Error-Response"><a href="#Error-Response" class="headerlink" title="Error Response"></a>Error Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VALIDATION_ERROR&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Email is required&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;email&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-01-27T10:30:00Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-Express-js-RESTful-API"><a href="#4-Express-js-RESTful-API" class="headerlink" title="4. Express.js RESTful API"></a>4. Express.js RESTful API</h2><h3 id="Basic-Setup"><a href="#Basic-Setup" class="headerlink" title="Basic Setup"></a>Basic Setup</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> helmet = <span class="built_in">require</span>(<span class="string">&#x27;helmet&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> rateLimit = <span class="built_in">require</span>(<span class="string">&#x27;express-rate-limit&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Middleware</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">helmet</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rate limiting</span></span><br><span class="line"><span class="keyword">const</span> limiter = <span class="title function_">rateLimit</span>(&#123;</span><br><span class="line">  <span class="attr">windowMs</span>: <span class="number">15</span> * <span class="number">60</span> * <span class="number">1000</span>, <span class="comment">// 15 minutes</span></span><br><span class="line">  <span class="attr">max</span>: <span class="number">100</span> <span class="comment">// limit each IP to 100 requests per windowMs</span></span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">use</span>(limiter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Routes</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/users&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./routes/users&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/posts&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./routes/posts&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error handling middleware</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err.<span class="property">stack</span>);</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">error</span>: &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;Internal Server Error&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server running on port <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="User-Routes"><a href="#User-Routes" class="headerlink" title="User Routes"></a>User Routes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/users.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; body, validationResult &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express-validator&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Validation middleware</span></span><br><span class="line"><span class="keyword">const</span> validateUser = [</span><br><span class="line">  <span class="title function_">body</span>(<span class="string">&#x27;name&#x27;</span>).<span class="title function_">trim</span>().<span class="title function_">isLength</span>(&#123; <span class="attr">min</span>: <span class="number">2</span> &#125;).<span class="title function_">withMessage</span>(<span class="string">&#x27;Name must be at least 2 characters&#x27;</span>),</span><br><span class="line">  <span class="title function_">body</span>(<span class="string">&#x27;email&#x27;</span>).<span class="title function_">isEmail</span>().<span class="title function_">normalizeEmail</span>().<span class="title function_">withMessage</span>(<span class="string">&#x27;Valid email is required&#x27;</span>),</span><br><span class="line">  <span class="title function_">body</span>(<span class="string">&#x27;age&#x27;</span>).<span class="title function_">isInt</span>(&#123; <span class="attr">min</span>: <span class="number">0</span>, <span class="attr">max</span>: <span class="number">120</span> &#125;).<span class="title function_">withMessage</span>(<span class="string">&#x27;Age must be between 0 and 120&#x27;</span>)</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET /api/users - Get all users</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; page = <span class="number">1</span>, limit = <span class="number">10</span>, search &#125; = req.<span class="property">query</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Simulate database query</span></span><br><span class="line">    <span class="keyword">let</span> users = [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;john@example.com&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;Jane Smith&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;jane@example.com&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;</span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Search functionality</span></span><br><span class="line">    <span class="keyword">if</span> (search) &#123;</span><br><span class="line">      users = users.<span class="title function_">filter</span>(<span class="function"><span class="params">user</span> =&gt;</span> </span><br><span class="line">        user.<span class="property">name</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(search.<span class="title function_">toLowerCase</span>()) ||</span><br><span class="line">        user.<span class="property">email</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(search.<span class="title function_">toLowerCase</span>())</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Pagination</span></span><br><span class="line">    <span class="keyword">const</span> startIndex = (page - <span class="number">1</span>) * limit;</span><br><span class="line">    <span class="keyword">const</span> endIndex = page * limit;</span><br><span class="line">    <span class="keyword">const</span> paginatedUsers = users.<span class="title function_">slice</span>(startIndex, endIndex);</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: paginatedUsers,</span><br><span class="line">      <span class="attr">pagination</span>: &#123;</span><br><span class="line">        <span class="attr">currentPage</span>: <span class="built_in">parseInt</span>(page),</span><br><span class="line">        <span class="attr">totalPages</span>: <span class="title class_">Math</span>.<span class="title function_">ceil</span>(users.<span class="property">length</span> / limit),</span><br><span class="line">        <span class="attr">totalItems</span>: users.<span class="property">length</span>,</span><br><span class="line">        <span class="attr">hasNext</span>: endIndex &lt; users.<span class="property">length</span>,</span><br><span class="line">        <span class="attr">hasPrev</span>: page &gt; <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET /api/users/:id - Get user by ID</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/:id&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Simulate database query</span></span><br><span class="line">    <span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="built_in">parseInt</span>(id), <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;john@example.com&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;User not found&#x27;</span> &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: user</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// POST /api/users - Create new user</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, validateUser, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Check validation errors</span></span><br><span class="line">    <span class="keyword">const</span> errors = <span class="title function_">validationResult</span>(req);</span><br><span class="line">    <span class="keyword">if</span> (!errors.<span class="title function_">isEmpty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123;</span><br><span class="line">          <span class="attr">code</span>: <span class="string">&#x27;VALIDATION_ERROR&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;Validation failed&#x27;</span>,</span><br><span class="line">          <span class="attr">details</span>: errors.<span class="title function_">array</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> &#123; name, email, age &#125; = req.<span class="property">body</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Simulate database insert</span></span><br><span class="line">    <span class="keyword">const</span> newUser = &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      name,</span><br><span class="line">      email,</span><br><span class="line">      <span class="attr">age</span>: <span class="built_in">parseInt</span>(age),</span><br><span class="line">      <span class="attr">createdAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>()</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: newUser,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;User created successfully&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// PUT /api/users/:id - Update user</span></span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&#x27;/:id&#x27;</span>, validateUser, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, email, age &#125; = req.<span class="property">body</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Check validation errors</span></span><br><span class="line">    <span class="keyword">const</span> errors = <span class="title function_">validationResult</span>(req);</span><br><span class="line">    <span class="keyword">if</span> (!errors.<span class="title function_">isEmpty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123;</span><br><span class="line">          <span class="attr">code</span>: <span class="string">&#x27;VALIDATION_ERROR&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;Validation failed&#x27;</span>,</span><br><span class="line">          <span class="attr">details</span>: errors.<span class="title function_">array</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Simulate database update</span></span><br><span class="line">    <span class="keyword">const</span> updatedUser = &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="built_in">parseInt</span>(id),</span><br><span class="line">      name,</span><br><span class="line">      email,</span><br><span class="line">      <span class="attr">age</span>: <span class="built_in">parseInt</span>(age),</span><br><span class="line">      <span class="attr">updatedAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>()</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: updatedUser,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;User updated successfully&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// DELETE /api/users/:id - Delete user</span></span><br><span class="line">router.<span class="title function_">delete</span>(<span class="string">&#x27;/:id&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Simulate database delete</span></span><br><span class="line">    <span class="comment">// const deletedUser = await User.findByIdAndDelete(id);</span></span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">204</span>).<span class="title function_">send</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<h2 id="5-Authentication-Authorization"><a href="#5-Authentication-Authorization" class="headerlink" title="5. Authentication &amp; Authorization"></a>5. Authentication &amp; Authorization</h2><h3 id="JWT-Authentication"><a href="#JWT-Authentication" class="headerlink" title="JWT Authentication"></a>JWT Authentication</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// middleware/auth.js</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">authenticateToken</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> authHeader = req.<span class="property">headers</span>[<span class="string">&#x27;authorization&#x27;</span>];</span><br><span class="line">  <span class="keyword">const</span> token = authHeader &amp;&amp; authHeader.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>]; <span class="comment">// Bearer TOKEN</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Access token required&#x27;</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  jwt.<span class="title function_">verify</span>(token, process.<span class="property">env</span>.<span class="property">JWT_SECRET</span>, <span class="function">(<span class="params">err, user</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Invalid or expired token&#x27;</span> &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    req.<span class="property">user</span> = user;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">authorizeRoles</span> = (<span class="params">...roles</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">user</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Authentication required&#x27;</span> &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!roles.<span class="title function_">includes</span>(req.<span class="property">user</span>.<span class="property">role</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Insufficient permissions&#x27;</span> &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; authenticateToken, authorizeRoles &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Login-Route"><a href="#Login-Route" class="headerlink" title="Login Route"></a>Login Route</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/auth.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; email, password &#125; = req.<span class="property">body</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Simulate user lookup</span></span><br><span class="line">    <span class="keyword">const</span> user = &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="string">&#x27;admin@example.com&#x27;</span>,</span><br><span class="line">      <span class="attr">password</span>: <span class="string">&#x27;$2a$10$hashedpassword&#x27;</span>,</span><br><span class="line">      <span class="attr">role</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Verify password</span></span><br><span class="line">    <span class="keyword">const</span> isValidPassword = <span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(password, user.<span class="property">password</span>);</span><br><span class="line">    <span class="keyword">if</span> (!isValidPassword) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Invalid credentials&#x27;</span> &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Generate JWT token</span></span><br><span class="line">    <span class="keyword">const</span> token = jwt.<span class="title function_">sign</span>(</span><br><span class="line">      &#123; <span class="attr">userId</span>: user.<span class="property">id</span>, <span class="attr">email</span>: user.<span class="property">email</span>, <span class="attr">role</span>: user.<span class="property">role</span> &#125;,</span><br><span class="line">      process.<span class="property">env</span>.<span class="property">JWT_SECRET</span>,</span><br><span class="line">      &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;24h&#x27;</span> &#125;</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        token,</span><br><span class="line">        <span class="attr">user</span>: &#123;</span><br><span class="line">          <span class="attr">id</span>: user.<span class="property">id</span>,</span><br><span class="line">          <span class="attr">email</span>: user.<span class="property">email</span>,</span><br><span class="line">          <span class="attr">role</span>: user.<span class="property">role</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;Login successful&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<h2 id="6-Database-Integration"><a href="#6-Database-Integration" class="headerlink" title="6. Database Integration"></a>6. Database Integration</h2><h3 id="MongoDB-voi-Mongoose"><a href="#MongoDB-voi-Mongoose" class="headerlink" title="MongoDB với Mongoose"></a>MongoDB với Mongoose</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// models/User.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: [<span class="literal">true</span>, <span class="string">&#x27;Name is required&#x27;</span>],</span><br><span class="line">    <span class="attr">trim</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minlength</span>: [<span class="number">2</span>, <span class="string">&#x27;Name must be at least 2 characters&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">email</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: [<span class="literal">true</span>, <span class="string">&#x27;Email is required&#x27;</span>],</span><br><span class="line">    <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">lowercase</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">match</span>: [<span class="regexp">/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w&#123;2,3&#125;)+$/</span>, <span class="string">&#x27;Please enter a valid email&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">age</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">min</span>: [<span class="number">0</span>, <span class="string">&#x27;Age cannot be negative&#x27;</span>],</span><br><span class="line">    <span class="attr">max</span>: [<span class="number">120</span>, <span class="string">&#x27;Age cannot exceed 120&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">role</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">enum</span>: [<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;moderator&#x27;</span>],</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;user&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">isActive</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">timestamps</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Indexes</span></span><br><span class="line">userSchema.<span class="title function_">index</span>(&#123; <span class="attr">email</span>: <span class="number">1</span> &#125;);</span><br><span class="line">userSchema.<span class="title function_">index</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;text&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Virtual fields</span></span><br><span class="line">userSchema.<span class="title function_">virtual</span>(<span class="string">&#x27;fullName&#x27;</span>).<span class="title function_">get</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> (<span class="subst">$&#123;<span class="variable language_">this</span>.email&#125;</span>)`</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Instance methods</span></span><br><span class="line">userSchema.<span class="property">methods</span>.<span class="property">toJSON</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="variable language_">this</span>.<span class="title function_">toObject</span>();</span><br><span class="line">  <span class="keyword">delete</span> user.<span class="property">__v</span>;</span><br><span class="line">  <span class="keyword">return</span> user;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Static methods</span></span><br><span class="line">userSchema.<span class="property">statics</span>.<span class="property">findByEmail</span> = <span class="keyword">function</span>(<span class="params">email</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">findOne</span>(&#123; <span class="attr">email</span>: email.<span class="title function_">toLowerCase</span>() &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure>

<h3 id="Updated-User-Routes-voi-Database"><a href="#Updated-User-Routes-voi-Database" class="headerlink" title="Updated User Routes với Database"></a>Updated User Routes với Database</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/users.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = <span class="built_in">require</span>(<span class="string">&#x27;../models/User&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; authenticateToken, authorizeRoles &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../middleware/auth&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET /api/users - Get all users (with pagination)</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, authenticateToken, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; page = <span class="number">1</span>, limit = <span class="number">10</span>, search, sort = <span class="string">&#x27;createdAt&#x27;</span>, order = <span class="string">&#x27;desc&#x27;</span> &#125; = req.<span class="property">query</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Build query</span></span><br><span class="line">    <span class="keyword">let</span> query = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (search) &#123;</span><br><span class="line">      query.<span class="property">$text</span> = &#123; <span class="attr">$search</span>: search &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Build sort object</span></span><br><span class="line">    <span class="keyword">const</span> sortObj = &#123;&#125;;</span><br><span class="line">    sortObj[sort] = order === <span class="string">&#x27;desc&#x27;</span> ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Execute query with pagination</span></span><br><span class="line">    <span class="keyword">const</span> users = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">find</span>(query)</span><br><span class="line">      .<span class="title function_">sort</span>(sortObj)</span><br><span class="line">      .<span class="title function_">limit</span>(limit * <span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">skip</span>((page - <span class="number">1</span>) * limit)</span><br><span class="line">      .<span class="title function_">exec</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Get total count</span></span><br><span class="line">    <span class="keyword">const</span> total = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">countDocuments</span>(query);</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: users,</span><br><span class="line">      <span class="attr">pagination</span>: &#123;</span><br><span class="line">        <span class="attr">currentPage</span>: <span class="built_in">parseInt</span>(page),</span><br><span class="line">        <span class="attr">totalPages</span>: <span class="title class_">Math</span>.<span class="title function_">ceil</span>(total / limit),</span><br><span class="line">        <span class="attr">totalItems</span>: total,</span><br><span class="line">        <span class="attr">hasNext</span>: page * limit &lt; total,</span><br><span class="line">        <span class="attr">hasPrev</span>: page &gt; <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// POST /api/users - Create user (admin only)</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, authenticateToken, <span class="title function_">authorizeRoles</span>(<span class="string">&#x27;admin&#x27;</span>), <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(req.<span class="property">body</span>);</span><br><span class="line">    <span class="keyword">await</span> user.<span class="title function_">save</span>();</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: user,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;User created successfully&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">code</span> === <span class="number">11000</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">409</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Email already exists&#x27;</span> &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<h2 id="7-API-Documentation-voi-Swagger"><a href="#7-API-Documentation-voi-Swagger" class="headerlink" title="7. API Documentation với Swagger"></a>7. API Documentation với Swagger</h2><h3 id="Swagger-Setup"><a href="#Swagger-Setup" class="headerlink" title="Swagger Setup"></a>Swagger Setup</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// swagger.js</span></span><br><span class="line"><span class="keyword">const</span> swaggerJsdoc = <span class="built_in">require</span>(<span class="string">&#x27;swagger-jsdoc&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> swaggerUi = <span class="built_in">require</span>(<span class="string">&#x27;swagger-ui-express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  <span class="attr">definition</span>: &#123;</span><br><span class="line">    <span class="attr">openapi</span>: <span class="string">&#x27;3.0.0&#x27;</span>,</span><br><span class="line">    <span class="attr">info</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;User Management API&#x27;</span>,</span><br><span class="line">      <span class="attr">version</span>: <span class="string">&#x27;1.0.0&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;A RESTful API for user management&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">servers</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;Development server&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">components</span>: &#123;</span><br><span class="line">      <span class="attr">securitySchemes</span>: &#123;</span><br><span class="line">        <span class="attr">bearerAuth</span>: &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">          <span class="attr">scheme</span>: <span class="string">&#x27;bearer&#x27;</span>,</span><br><span class="line">          <span class="attr">bearerFormat</span>: <span class="string">&#x27;JWT&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">apis</span>: [<span class="string">&#x27;./routes/*.js&#x27;</span>], <span class="comment">// Path to the API docs</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> specs = <span class="title function_">swaggerJsdoc</span>(options);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; specs, swaggerUi &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Swagger-Documentation"><a href="#Swagger-Documentation" class="headerlink" title="Swagger Documentation"></a>Swagger Documentation</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@swagger</span></span></span><br><span class="line"><span class="comment"> * components:</span></span><br><span class="line"><span class="comment"> *   schemas:</span></span><br><span class="line"><span class="comment"> *     User:</span></span><br><span class="line"><span class="comment"> *       type: object</span></span><br><span class="line"><span class="comment"> *       required:</span></span><br><span class="line"><span class="comment"> *         - name</span></span><br><span class="line"><span class="comment"> *         - email</span></span><br><span class="line"><span class="comment"> *       properties:</span></span><br><span class="line"><span class="comment"> *         id:</span></span><br><span class="line"><span class="comment"> *           type: string</span></span><br><span class="line"><span class="comment"> *           description: Auto-generated user ID</span></span><br><span class="line"><span class="comment"> *         name:</span></span><br><span class="line"><span class="comment"> *           type: string</span></span><br><span class="line"><span class="comment"> *           description: User&#x27;s full name</span></span><br><span class="line"><span class="comment"> *         email:</span></span><br><span class="line"><span class="comment"> *           type: string</span></span><br><span class="line"><span class="comment"> *           description: User&#x27;s email address</span></span><br><span class="line"><span class="comment"> *         age:</span></span><br><span class="line"><span class="comment"> *           type: number</span></span><br><span class="line"><span class="comment"> *           description: User&#x27;s age</span></span><br><span class="line"><span class="comment"> *         role:</span></span><br><span class="line"><span class="comment"> *           type: string</span></span><br><span class="line"><span class="comment"> *           enum: [user, admin, moderator]</span></span><br><span class="line"><span class="comment"> *           description: User&#x27;s role</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@swagger</span></span></span><br><span class="line"><span class="comment"> * /api/users:</span></span><br><span class="line"><span class="comment"> *   get:</span></span><br><span class="line"><span class="comment"> *     summary: Get all users</span></span><br><span class="line"><span class="comment"> *     tags: [Users]</span></span><br><span class="line"><span class="comment"> *     security:</span></span><br><span class="line"><span class="comment"> *       - bearerAuth: []</span></span><br><span class="line"><span class="comment"> *     parameters:</span></span><br><span class="line"><span class="comment"> *       - in: query</span></span><br><span class="line"><span class="comment"> *         name: page</span></span><br><span class="line"><span class="comment"> *         schema:</span></span><br><span class="line"><span class="comment"> *           type: integer</span></span><br><span class="line"><span class="comment"> *           default: 1</span></span><br><span class="line"><span class="comment"> *         description: Page number</span></span><br><span class="line"><span class="comment"> *       - in: query</span></span><br><span class="line"><span class="comment"> *         name: limit</span></span><br><span class="line"><span class="comment"> *         schema:</span></span><br><span class="line"><span class="comment"> *           type: integer</span></span><br><span class="line"><span class="comment"> *           default: 10</span></span><br><span class="line"><span class="comment"> *         description: Number of items per page</span></span><br><span class="line"><span class="comment"> *     responses:</span></span><br><span class="line"><span class="comment"> *       200:</span></span><br><span class="line"><span class="comment"> *         description: List of users</span></span><br><span class="line"><span class="comment"> *         content:</span></span><br><span class="line"><span class="comment"> *           application/json:</span></span><br><span class="line"><span class="comment"> *             schema:</span></span><br><span class="line"><span class="comment"> *               type: object</span></span><br><span class="line"><span class="comment"> *               properties:</span></span><br><span class="line"><span class="comment"> *                 success:</span></span><br><span class="line"><span class="comment"> *                   type: boolean</span></span><br><span class="line"><span class="comment"> *                 data:</span></span><br><span class="line"><span class="comment"> *                   type: array</span></span><br><span class="line"><span class="comment"> *                   items:</span></span><br><span class="line"><span class="comment"> *                     $ref: &#x27;#/components/schemas/User&#x27;</span></span><br><span class="line"><span class="comment"> *       401:</span></span><br><span class="line"><span class="comment"> *         description: Unauthorized</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h2 id="8-Testing-voi-Jest"><a href="#8-Testing-voi-Jest" class="headerlink" title="8. Testing với Jest"></a>8. Testing với Jest</h2><h3 id="API-Testing"><a href="#API-Testing" class="headerlink" title="API Testing"></a>API Testing</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tests/users.test.js</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;supertest&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">&#x27;../app&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;User API&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> authToken;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">beforeAll</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// Connect to test database</span></span><br><span class="line">    <span class="keyword">await</span> mongoose.<span class="title function_">connect</span>(process.<span class="property">env</span>.<span class="property">MONGODB_TEST_URI</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Login to get auth token</span></span><br><span class="line">    <span class="keyword">const</span> loginResponse = <span class="keyword">await</span> <span class="title function_">request</span>(app)</span><br><span class="line">      .<span class="title function_">post</span>(<span class="string">&#x27;/api/auth/login&#x27;</span>)</span><br><span class="line">      .<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&#x27;admin@example.com&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;password123&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    </span><br><span class="line">    authToken = loginResponse.<span class="property">body</span>.<span class="property">data</span>.<span class="property">token</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">afterAll</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> mongoose.<span class="property">connection</span>.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;GET /api/users&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should return list of users&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">request</span>(app)</span><br><span class="line">        .<span class="title function_">get</span>(<span class="string">&#x27;/api/users&#x27;</span>)</span><br><span class="line">        .<span class="title function_">set</span>(<span class="string">&#x27;Authorization&#x27;</span>, <span class="string">`Bearer <span class="subst">$&#123;authToken&#125;</span>`</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">status</span>).<span class="title function_">toBe</span>(<span class="number">200</span>);</span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">body</span>.<span class="property">success</span>).<span class="title function_">toBe</span>(<span class="literal">true</span>);</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(response.<span class="property">body</span>.<span class="property">data</span>)).<span class="title function_">toBe</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should require authentication&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">request</span>(app)</span><br><span class="line">        .<span class="title function_">get</span>(<span class="string">&#x27;/api/users&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">status</span>).<span class="title function_">toBe</span>(<span class="number">401</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;POST /api/users&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should create a new user&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> newUser = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Test User&#x27;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&#x27;test@example.com&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">25</span></span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">request</span>(app)</span><br><span class="line">        .<span class="title function_">post</span>(<span class="string">&#x27;/api/users&#x27;</span>)</span><br><span class="line">        .<span class="title function_">set</span>(<span class="string">&#x27;Authorization&#x27;</span>, <span class="string">`Bearer <span class="subst">$&#123;authToken&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">send</span>(newUser);</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">status</span>).<span class="title function_">toBe</span>(<span class="number">201</span>);</span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">body</span>.<span class="property">success</span>).<span class="title function_">toBe</span>(<span class="literal">true</span>);</span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">body</span>.<span class="property">data</span>.<span class="property">name</span>).<span class="title function_">toBe</span>(newUser.<span class="property">name</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should validate required fields&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> invalidUser = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Test&#x27;</span></span><br><span class="line">        <span class="comment">// Missing email</span></span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">request</span>(app)</span><br><span class="line">        .<span class="title function_">post</span>(<span class="string">&#x27;/api/users&#x27;</span>)</span><br><span class="line">        .<span class="title function_">set</span>(<span class="string">&#x27;Authorization&#x27;</span>, <span class="string">`Bearer <span class="subst">$&#123;authToken&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">send</span>(invalidUser);</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">status</span>).<span class="title function_">toBe</span>(<span class="number">400</span>);</span><br><span class="line">      <span class="title function_">expect</span>(response.<span class="property">body</span>.<span class="property">success</span>).<span class="title function_">toBe</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="9-Rate-Limiting-Caching"><a href="#9-Rate-Limiting-Caching" class="headerlink" title="9. Rate Limiting &amp; Caching"></a>9. Rate Limiting &amp; Caching</h2><h3 id="Advanced-Rate-Limiting"><a href="#Advanced-Rate-Limiting" class="headerlink" title="Advanced Rate Limiting"></a>Advanced Rate Limiting</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// middleware/rateLimit.js</span></span><br><span class="line"><span class="keyword">const</span> rateLimit = <span class="built_in">require</span>(<span class="string">&#x27;express-rate-limit&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RedisStore</span> = <span class="built_in">require</span>(<span class="string">&#x27;rate-limit-redis&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = redis.<span class="title function_">createClient</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: process.<span class="property">env</span>.<span class="property">REDIS_HOST</span>,</span><br><span class="line">  <span class="attr">port</span>: process.<span class="property">env</span>.<span class="property">REDIS_PORT</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// General rate limit</span></span><br><span class="line"><span class="keyword">const</span> generalLimiter = <span class="title function_">rateLimit</span>(&#123;</span><br><span class="line">  <span class="attr">store</span>: <span class="keyword">new</span> <span class="title class_">RedisStore</span>(&#123;</span><br><span class="line">    <span class="attr">client</span>: client,</span><br><span class="line">    <span class="attr">prefix</span>: <span class="string">&#x27;rl:general:&#x27;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">windowMs</span>: <span class="number">15</span> * <span class="number">60</span> * <span class="number">1000</span>, <span class="comment">// 15 minutes</span></span><br><span class="line">  <span class="attr">max</span>: <span class="number">100</span>, <span class="comment">// limit each IP to 100 requests per windowMs</span></span><br><span class="line">  <span class="attr">message</span>: &#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">error</span>: &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;Too many requests, please try again later&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Strict rate limit for auth routes</span></span><br><span class="line"><span class="keyword">const</span> authLimiter = <span class="title function_">rateLimit</span>(&#123;</span><br><span class="line">  <span class="attr">store</span>: <span class="keyword">new</span> <span class="title class_">RedisStore</span>(&#123;</span><br><span class="line">    <span class="attr">client</span>: client,</span><br><span class="line">    <span class="attr">prefix</span>: <span class="string">&#x27;rl:auth:&#x27;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">windowMs</span>: <span class="number">15</span> * <span class="number">60</span> * <span class="number">1000</span>, <span class="comment">// 15 minutes</span></span><br><span class="line">  <span class="attr">max</span>: <span class="number">5</span>, <span class="comment">// limit each IP to 5 requests per windowMs</span></span><br><span class="line">  <span class="attr">message</span>: &#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">error</span>: &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;Too many login attempts, please try again later&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; generalLimiter, authLimiter &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Caching-voi-Redis"><a href="#Caching-voi-Redis" class="headerlink" title="Caching với Redis"></a>Caching với Redis</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// middleware/cache.js</span></span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = redis.<span class="title function_">createClient</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: process.<span class="property">env</span>.<span class="property">REDIS_HOST</span>,</span><br><span class="line">  <span class="attr">port</span>: process.<span class="property">env</span>.<span class="property">REDIS_PORT</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">cache</span> = (<span class="params">duration = <span class="number">300</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="string">`cache:<span class="subst">$&#123;req.originalUrl&#125;</span>`</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> cachedData = <span class="keyword">await</span> client.<span class="title function_">get</span>(key);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (cachedData) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">json</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(cachedData));</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// Store original send function</span></span><br><span class="line">      <span class="keyword">const</span> originalSend = res.<span class="property">json</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// Override send function</span></span><br><span class="line">      res.<span class="property">json</span> = <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="comment">// Cache the response</span></span><br><span class="line">        client.<span class="title function_">setex</span>(key, duration, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Call original send</span></span><br><span class="line">        originalSend.<span class="title function_">call</span>(<span class="variable language_">this</span>, data);</span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = cache;</span><br></pre></td></tr></table></figure>

<h2 id="10-Vi-du-thuc-te-E-commerce-API"><a href="#10-Vi-du-thuc-te-E-commerce-API" class="headerlink" title="10. Ví dụ thực tế: E-commerce API"></a>10. Ví dụ thực tế: E-commerce API</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Complete E-commerce API structure</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Middleware</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">helmet</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Routes</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/auth&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./routes/auth&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/users&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./routes/users&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/products&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./routes/products&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/orders&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./routes/orders&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/cart&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./routes/cart&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Product Routes Example</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/products&#x27;</span>, <span class="title function_">cache</span>(<span class="number">300</span>), <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; category, minPrice, maxPrice, sort, page = <span class="number">1</span>, limit = <span class="number">20</span> &#125; = req.<span class="property">query</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> query = &#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (category) query.<span class="property">category</span> = category;</span><br><span class="line">    <span class="keyword">if</span> (minPrice || maxPrice) &#123;</span><br><span class="line">      query.<span class="property">price</span> = &#123;&#125;;</span><br><span class="line">      <span class="keyword">if</span> (minPrice) query.<span class="property">price</span>.<span class="property">$gte</span> = <span class="built_in">parseFloat</span>(minPrice);</span><br><span class="line">      <span class="keyword">if</span> (maxPrice) query.<span class="property">price</span>.<span class="property">$lte</span> = <span class="built_in">parseFloat</span>(maxPrice);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> products = <span class="keyword">await</span> <span class="title class_">Product</span>.<span class="title function_">find</span>(query)</span><br><span class="line">      .<span class="title function_">sort</span>(sort || <span class="string">&#x27;createdAt&#x27;</span>)</span><br><span class="line">      .<span class="title function_">limit</span>(limit * <span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">skip</span>((page - <span class="number">1</span>) * limit)</span><br><span class="line">      .<span class="title function_">populate</span>(<span class="string">&#x27;category&#x27;</span>, <span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> total = <span class="keyword">await</span> <span class="title class_">Product</span>.<span class="title function_">countDocuments</span>(query);</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: products,</span><br><span class="line">      <span class="attr">pagination</span>: &#123;</span><br><span class="line">        <span class="attr">currentPage</span>: <span class="built_in">parseInt</span>(page),</span><br><span class="line">        <span class="attr">totalPages</span>: <span class="title class_">Math</span>.<span class="title function_">ceil</span>(total / limit),</span><br><span class="line">        <span class="attr">totalItems</span>: total</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Order Processing</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/orders&#x27;</span>, authenticateToken, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; items, shippingAddress, paymentMethod &#125; = req.<span class="property">body</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Validate items</span></span><br><span class="line">    <span class="keyword">if</span> (!items || items.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Order must contain at least one item&#x27;</span> &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Calculate total</span></span><br><span class="line">    <span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> items) &#123;</span><br><span class="line">      <span class="keyword">const</span> product = <span class="keyword">await</span> <span class="title class_">Product</span>.<span class="title function_">findById</span>(item.<span class="property">productId</span>);</span><br><span class="line">      <span class="keyword">if</span> (!product) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">          <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">error</span>: &#123; <span class="attr">message</span>: <span class="string">`Product <span class="subst">$&#123;item.productId&#125;</span> not found`</span> &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      total += product.<span class="property">price</span> * item.<span class="property">quantity</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create order</span></span><br><span class="line">    <span class="keyword">const</span> order = <span class="keyword">new</span> <span class="title class_">Order</span>(&#123;</span><br><span class="line">      <span class="attr">user</span>: req.<span class="property">user</span>.<span class="property">userId</span>,</span><br><span class="line">      items,</span><br><span class="line">      total,</span><br><span class="line">      shippingAddress,</span><br><span class="line">      paymentMethod,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&#x27;pending&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> order.<span class="title function_">save</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Clear user&#x27;s cart</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Cart</span>.<span class="title function_">findOneAndUpdate</span>(</span><br><span class="line">      &#123; <span class="attr">user</span>: req.<span class="property">user</span>.<span class="property">userId</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">items</span>: [] &#125;</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: order,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;Order created successfully&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">message</span>: error.<span class="property">message</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="11-Best-Practices"><a href="#11-Best-Practices" class="headerlink" title="11. Best Practices"></a>11. Best Practices</h2><h3 id="API-Design-Best-Practices"><a href="#API-Design-Best-Practices" class="headerlink" title="API Design Best Practices"></a>API Design Best Practices</h3><ol>
<li><strong>Use HTTP methods correctly</strong>: GET, POST, PUT, DELETE</li>
<li><strong>Consistent URL structure</strong>: <code>/api/resource/:id</code></li>
<li><strong>Proper status codes</strong>: 200, 201, 400, 401, 404, 500</li>
<li><strong>Standard response format</strong>: success, data, error, message</li>
<li><strong>Pagination</strong>: page, limit, total</li>
<li><strong>Filtering &amp; Sorting</strong>: search, sort, order</li>
<li><strong>Versioning</strong>: <code>/api/v1/users</code></li>
<li><strong>Documentation</strong>: Swagger&#x2F;OpenAPI</li>
<li><strong>Rate limiting</strong>: Prevent abuse</li>
<li><strong>Caching</strong>: Improve performance</li>
<li><strong>Security</strong>: Authentication, authorization, validation</li>
<li><strong>Error handling</strong>: Consistent error responses</li>
<li><strong>Logging</strong>: Request&#x2F;response logging</li>
<li><strong>Testing</strong>: Unit tests, integration tests</li>
<li><strong>Monitoring</strong>: Health checks, metrics</li>
</ol>
<h3 id="Security-Best-Practices"><a href="#Security-Best-Practices" class="headerlink" title="Security Best Practices"></a>Security Best Practices</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Security middleware</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">helmet</span>()); <span class="comment">// Security headers</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>(&#123;</span><br><span class="line">  <span class="attr">origin</span>: process.<span class="property">env</span>.<span class="property">ALLOWED_ORIGINS</span>?.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>) || [<span class="string">&#x27;http://localhost:3000&#x27;</span>],</span><br><span class="line">  <span class="attr">credentials</span>: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Input validation</span></span><br><span class="line"><span class="keyword">const</span> &#123; body, validationResult &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express-validator&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// SQL injection prevention (use parameterized queries)</span></span><br><span class="line"><span class="comment">// XSS prevention (sanitize inputs)</span></span><br><span class="line"><span class="comment">// CSRF protection</span></span><br><span class="line"><span class="comment">// Rate limiting</span></span><br><span class="line"><span class="comment">// JWT token expiration</span></span><br><span class="line"><span class="comment">// Password hashing</span></span><br><span class="line"><span class="comment">// HTTPS only in production</span></span><br></pre></td></tr></table></figure>

<p>RESTful API là nền tảng của modern web development. Việc thiết kế và implement API theo chuẩn REST sẽ giúp tạo ra hệ thống scalable, maintainable và user-friendly.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Vui lòng kích hoạt JavaScript để xem các bình luận.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Trang chủ</a></li>
        
          <li><a href="/about/">Giới thiệu</a></li>
        
          <li><a href="/archives/">Bài viết</a></li>
        
          <li><a href="https://github.com/ph4n4n">Dự án</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Zero-to-Hero-RESTful-API-Thiet-ke-va-xay-dung-API-chuan"><span class="toc-number">1.</span> <span class="toc-text">Zero to Hero: RESTful API - Thiết kế và xây dựng API chuẩn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-RESTful-API-la-gi"><span class="toc-number">1.1.</span> <span class="toc-text">1. RESTful API là gì?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dac-diem-chinh"><span class="toc-number">1.1.1.</span> <span class="toc-text">Đặc điểm chính:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-Methods"><span class="toc-number">1.1.2.</span> <span class="toc-text">HTTP Methods</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-HTTP-Status-Codes"><span class="toc-number">1.2.</span> <span class="toc-text">2. HTTP Status Codes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2xx-Success"><span class="toc-number">1.2.1.</span> <span class="toc-text">2xx Success</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4xx-Client-Errors"><span class="toc-number">1.2.2.</span> <span class="toc-text">4xx Client Errors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5xx-Server-Errors"><span class="toc-number">1.2.3.</span> <span class="toc-text">5xx Server Errors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-API-Design-Principles"><span class="toc-number">1.3.</span> <span class="toc-text">3. API Design Principles</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#URL-Design"><span class="toc-number">1.3.1.</span> <span class="toc-text">URL Design</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Response-Format"><span class="toc-number">1.3.2.</span> <span class="toc-text">Response Format</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Error-Response"><span class="toc-number">1.3.3.</span> <span class="toc-text">Error Response</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Express-js-RESTful-API"><span class="toc-number">1.4.</span> <span class="toc-text">4. Express.js RESTful API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Setup"><span class="toc-number">1.4.1.</span> <span class="toc-text">Basic Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#User-Routes"><span class="toc-number">1.4.2.</span> <span class="toc-text">User Routes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Authentication-Authorization"><span class="toc-number">1.5.</span> <span class="toc-text">5. Authentication &amp; Authorization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT-Authentication"><span class="toc-number">1.5.1.</span> <span class="toc-text">JWT Authentication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Login-Route"><span class="toc-number">1.5.2.</span> <span class="toc-text">Login Route</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Database-Integration"><span class="toc-number">1.6.</span> <span class="toc-text">6. Database Integration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-voi-Mongoose"><span class="toc-number">1.6.1.</span> <span class="toc-text">MongoDB với Mongoose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Updated-User-Routes-voi-Database"><span class="toc-number">1.6.2.</span> <span class="toc-text">Updated User Routes với Database</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-API-Documentation-voi-Swagger"><span class="toc-number">1.7.</span> <span class="toc-text">7. API Documentation với Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger-Setup"><span class="toc-number">1.7.1.</span> <span class="toc-text">Swagger Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger-Documentation"><span class="toc-number">1.7.2.</span> <span class="toc-text">Swagger Documentation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Testing-voi-Jest"><span class="toc-number">1.8.</span> <span class="toc-text">8. Testing với Jest</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API-Testing"><span class="toc-number">1.8.1.</span> <span class="toc-text">API Testing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Rate-Limiting-Caching"><span class="toc-number">1.9.</span> <span class="toc-text">9. Rate Limiting &amp; Caching</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Advanced-Rate-Limiting"><span class="toc-number">1.9.1.</span> <span class="toc-text">Advanced Rate Limiting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Caching-voi-Redis"><span class="toc-number">1.9.2.</span> <span class="toc-text">Caching với Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Vi-du-thuc-te-E-commerce-API"><span class="toc-number">1.10.</span> <span class="toc-text">10. Ví dụ thực tế: E-commerce API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Best-Practices"><span class="toc-number">1.11.</span> <span class="toc-text">11. Best Practices</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API-Design-Best-Practices"><span class="toc-number">1.11.1.</span> <span class="toc-text">API Design Best Practices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Security-Best-Practices"><span class="toc-number">1.11.2.</span> <span class="toc-text">Security Best Practices</span></a></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&text=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&is_video=false&description=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn&body=Check out this article: https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&title=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&name=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph4n4n.github.io/2025/06/26/Zero-to-hero-RestfulAPI/&t=Zero to Hero: RESTful API - Thiết Kế Và Xây Dựng API Chuẩn"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Chia sẻ</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Về đầu trang</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Bản quyền &copy;
    
    
    2018-2025
    ph4n4n
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Trang chủ</a></li><!--
     --><!--
       --><li><a href="/about/">Giới thiệu</a></li><!--
     --><!--
       --><li><a href="/archives/">Bài viết</a></li><!--
     --><!--
       --><li><a href="https://github.com/ph4n4n">Dự án</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'https-ph4n4n-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->


<script>
(function() {
  var fallbackQuotes = [
    {q: 'Stay hungry, stay foolish.', a: 'Steve Jobs'},
    {q: 'Không có thành công nào mà không phải trả giá.', a: 'Ẩn danh'},
    {q: 'Simplicity is the soul of efficiency.', a: 'Austin Freeman'},
    {q: 'Hãy kiên trì, mọi thứ rồi sẽ ổn.', a: 'Ẩn danh'},
    {q: 'Code is like humor. When you have to explain it, it\'s bad.', a: 'Cory House'},
    {q: 'Chỉ cần bạn không dừng lại thì việc bạn tiến chậm cũng không là vấn đề.', a: 'Khổng Tử'},
    {q: 'The best way to get started is to quit talking and begin doing.', a: 'Walt Disney'},
    {q: 'Muốn đi nhanh thì đi một mình, muốn đi xa thì đi cùng nhau.', a: 'Tục ngữ'},
    {q: 'First, solve the problem. Then, write the code.', a: 'John Johnson'},
    {q: 'Đừng sợ thất bại, hãy sợ không thử.', a: 'Ẩn danh'},
    {q: 'No code no bug, no bug no life.', a: 'ph4n4n'},
    {q: 'No code no bug, no code no food.', a: 'ph4n4n'},
    {q: 'The only way to do great work is to love what you do.', a: 'Steve Jobs'},
    {q: 'Je suis món ennemi.', a: 'ph4n4n'},
    {q: 'Chết không phải lúc trái tim ngừng đập, chết là khi ý chí ngừng tiến lên.', a: 'ChatGPT'},
  ];
  var el = document.getElementById('random-quote');
  function showQuote(q, a) {
    if (el) el.innerHTML = q + (a ? ' <span style="font-size:0.95em;color:#888;">– ' + a + '</span>' : '');
  }
  function showFallback() {
    var r = fallbackQuotes[Math.floor(Math.random() * fallbackQuotes.length)];
    showQuote(r.q, r.a);
  }
  fetch('https://zenquotes.io/api/random')
    .then(function(res) { return res.ok ? res.json() : Promise.reject(); })
    .then(function(data) {
      if (Array.isArray(data) && data[0] && data[0].q) {
        showQuote(data[0].q, data[0].a);
      } else {
        showFallback();
      }
    })
    .catch(showFallback);
})();
</script>
</body>
</html>
