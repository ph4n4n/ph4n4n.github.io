<!DOCTYPE html>
<html lang=vi>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Zero to Hero: NestJS - Enterprise Framework cho Node.jsNestJS là framework enterprise-grade cho Node.js, được xây dựng với TypeScript và lấy cảm hứng từ Angular. Nó cung cấp kiến trúc scalable, depend">
<meta property="og:type" content="article">
<meta property="og:title" content="Zero to Hero: NestJS - Enterprise Framework Cho Node.js">
<meta property="og:url" content="https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/index.html">
<meta property="og:site_name" content="ph4n4n&#39;s code notes &amp; tips">
<meta property="og:description" content="Zero to Hero: NestJS - Enterprise Framework cho Node.jsNestJS là framework enterprise-grade cho Node.js, được xây dựng với TypeScript và lấy cảm hứng từ Angular. Nó cung cấp kiến trúc scalable, depend">
<meta property="og:locale" content="vi_VN">
<meta property="article:published_time" content="2025-01-27T03:00:00.000Z">
<meta property="article:modified_time" content="2025-06-27T02:48:52.590Z">
<meta property="article:author" content="ph4n4n">
<meta property="article:tag" content="Node.js">
<meta property="article:tag" content="TypeScript">
<meta property="article:tag" content="Microservices">
<meta property="article:tag" content="Backend">
<meta property="article:tag" content="NestJS">
<meta property="article:tag" content="Framework">
<meta property="article:tag" content="Enterprise">
<meta property="article:tag" content="Dependency Injection">
<meta property="article:tag" content="Decorators">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Zero to Hero: NestJS - Enterprise Framework Cho Node.js</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- Monaco font override -->
    
<link rel="stylesheet" href="/css/monaco-override.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="ph4n4n&#39;s code notes &amp; tips" type="application/atom+xml" />
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Trang chủ</a></li><!--
     --><!--
       --><li><a href="/about/">Giới thiệu</a></li><!--
     --><!--
       --><li><a href="/archives/">Bài viết</a></li><!--
     --><!--
       --><li><a href="https://github.com/ph4n4n">Dự án</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Bài trước" href="/2025/01/27/Zero-to-hero-MySQL/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Bài tiếp theo" href="/2025/01/27/Zero-to-hero-Python/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Về đầu trang" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Chia sẻ bài viết" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Bài trước</span>
      <span id="i-next" class="info" style="display:none;">Bài tiếp theo</span>
      <span id="i-top" class="info" style="display:none;">Về đầu trang</span>
      <span id="i-share" class="info" style="display:none;">Chia sẻ bài viết</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&text=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&is_video=false&description=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Zero to Hero: NestJS - Enterprise Framework Cho Node.js&body=Check out this article: https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&name=Zero to Hero: NestJS - Enterprise Framework Cho Node.js&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&t=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Zero-to-Hero-NestJS-Enterprise-Framework-cho-Node-js"><span class="toc-number">1.</span> <span class="toc-text">Zero to Hero: NestJS - Enterprise Framework cho Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Tai-sao-chon-NestJS"><span class="toc-number">1.1.</span> <span class="toc-text">1. Tại sao chọn NestJS?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#So-sanh-voi-Express-js"><span class="toc-number">1.1.1.</span> <span class="toc-text">So sánh với Express.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Loi-ich-cua-NestJS"><span class="toc-number">1.1.2.</span> <span class="toc-text">Lợi ích của NestJS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Cai-dat-va-Setup"><span class="toc-number">1.2.</span> <span class="toc-text">2. Cài đặt và Setup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cai-dat-NestJS-CLI"><span class="toc-number">1.2.1.</span> <span class="toc-text">Cài đặt NestJS CLI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cau-truc-project"><span class="toc-number">1.2.2.</span> <span class="toc-text">Cấu trúc project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-ts-Entry-point"><span class="toc-number">1.2.3.</span> <span class="toc-text">main.ts - Entry point</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Core-Concepts"><span class="toc-number">1.3.</span> <span class="toc-text">3. Core Concepts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Modules"><span class="toc-number">1.3.1.</span> <span class="toc-text">Modules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Controllers"><span class="toc-number">1.3.2.</span> <span class="toc-text">Controllers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Services"><span class="toc-number">1.3.3.</span> <span class="toc-text">Services</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-DTOs-va-Validation"><span class="toc-number">1.4.</span> <span class="toc-text">4. DTOs và Validation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DTOs-Data-Transfer-Objects"><span class="toc-number">1.4.1.</span> <span class="toc-text">DTOs (Data Transfer Objects)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Validation-Pipes"><span class="toc-number">1.4.2.</span> <span class="toc-text">Custom Validation Pipes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Authentication-Authorization"><span class="toc-number">1.5.</span> <span class="toc-text">5. Authentication &amp; Authorization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT-Strategy"><span class="toc-number">1.5.1.</span> <span class="toc-text">JWT Strategy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Guards"><span class="toc-number">1.5.2.</span> <span class="toc-text">Guards</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decorators"><span class="toc-number">1.5.3.</span> <span class="toc-text">Decorators</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Database-Integration"><span class="toc-number">1.6.</span> <span class="toc-text">6. Database Integration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeORM-Configuration"><span class="toc-number">1.6.1.</span> <span class="toc-text">TypeORM Configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Entity"><span class="toc-number">1.6.2.</span> <span class="toc-text">Entity</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Interceptors-va-Filters"><span class="toc-number">1.7.</span> <span class="toc-text">7. Interceptors và Filters</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Response-Interceptor"><span class="toc-number">1.7.1.</span> <span class="toc-text">Response Interceptor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exception-Filter"><span class="toc-number">1.7.2.</span> <span class="toc-text">Exception Filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Testing"><span class="toc-number">1.8.</span> <span class="toc-text">8. Testing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unit-Testing"><span class="toc-number">1.8.1.</span> <span class="toc-text">Unit Testing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E2E-Testing"><span class="toc-number">1.8.2.</span> <span class="toc-text">E2E Testing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Configuration-Management"><span class="toc-number">1.9.</span> <span class="toc-text">9. Configuration Management</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Environment-Configuration"><span class="toc-number">1.9.1.</span> <span class="toc-text">Environment Configuration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Microservices"><span class="toc-number">1.10.</span> <span class="toc-text">10. Microservices</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-Microservice"><span class="toc-number">1.10.1.</span> <span class="toc-text">TCP Microservice</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vi-du-thuc-te-E-commerce-API"><span class="toc-number">1.11.</span> <span class="toc-text">Ví dụ thực tế: E-commerce API</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Zero to Hero: NestJS - Enterprise Framework Cho Node.js
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">ph4n4n</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-01-27T03:00:00.000Z" class="dt-published" itemprop="datePublished">2025-01-27</time>
        
        (Updated: <time datetime="2025-06-27T02:48:52.590Z" class="dt-updated" itemprop="dateModified">2025-06-27</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Backend/">Backend</a> › <a class="category-link" href="/categories/Backend/NestJS/">NestJS</a> › <a class="category-link" href="/categories/Backend/NestJS/TypeScript/">TypeScript</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Backend/" rel="tag">Backend</a>, <a class="p-category" href="/tags/Decorators/" rel="tag">Decorators</a>, <a class="p-category" href="/tags/Dependency-Injection/" rel="tag">Dependency Injection</a>, <a class="p-category" href="/tags/Enterprise/" rel="tag">Enterprise</a>, <a class="p-category" href="/tags/Framework/" rel="tag">Framework</a>, <a class="p-category" href="/tags/Microservices/" rel="tag">Microservices</a>, <a class="p-category" href="/tags/NestJS/" rel="tag">NestJS</a>, <a class="p-category" href="/tags/Node-js/" rel="tag">Node.js</a>, <a class="p-category" href="/tags/TypeScript/" rel="tag">TypeScript</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Zero-to-Hero-NestJS-Enterprise-Framework-cho-Node-js"><a href="#Zero-to-Hero-NestJS-Enterprise-Framework-cho-Node-js" class="headerlink" title="Zero to Hero: NestJS - Enterprise Framework cho Node.js"></a>Zero to Hero: NestJS - Enterprise Framework cho Node.js</h1><p>NestJS là framework enterprise-grade cho Node.js, được xây dựng với TypeScript và lấy cảm hứng từ Angular. Nó cung cấp kiến trúc scalable, dependency injection, và các tính năng enterprise.</p>
<h2 id="1-Tai-sao-chon-NestJS"><a href="#1-Tai-sao-chon-NestJS" class="headerlink" title="1. Tại sao chọn NestJS?"></a>1. Tại sao chọn NestJS?</h2><h3 id="So-sanh-voi-Express-js"><a href="#So-sanh-voi-Express-js" class="headerlink" title="So sánh với Express.js"></a>So sánh với Express.js</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Express.js - Manual setup</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> userController = <span class="built_in">require</span>(<span class="string">&#x27;./controllers/userController&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> userService = <span class="built_in">require</span>(<span class="string">&#x27;./services/userService&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/users&#x27;</span>, userController.<span class="property">getUsers</span>);</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/users&#x27;</span>, userController.<span class="property">createUser</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// NestJS - Structured &amp; Decorated</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="attr">userService</span>: <span class="title class_">UserService</span></span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  <span class="title function_">getUsers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">findAll</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Post</span>()</span><br><span class="line">  <span class="title function_">createUser</span>(<span class="params"><span class="meta">@Body</span>() <span class="attr">createUserDto</span>: <span class="title class_">CreateUserDto</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">create</span>(createUserDto);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Loi-ich-cua-NestJS"><a href="#Loi-ich-cua-NestJS" class="headerlink" title="Lợi ích của NestJS"></a>Lợi ích của NestJS</h3><ul>
<li><strong>TypeScript-first</strong>: Type safety từ đầu</li>
<li><strong>Dependency Injection</strong>: Loose coupling</li>
<li><strong>Decorators</strong>: Clean, readable code</li>
<li><strong>Modular Architecture</strong>: Scalable structure</li>
<li><strong>Built-in Validation</strong>: DTOs và pipes</li>
<li><strong>Testing Support</strong>: Easy unit testing</li>
<li><strong>OpenAPI</strong>: Auto-generated documentation</li>
</ul>
<h2 id="2-Cai-dat-va-Setup"><a href="#2-Cai-dat-va-Setup" class="headerlink" title="2. Cài đặt và Setup"></a>2. Cài đặt và Setup</h2><h3 id="Cai-dat-NestJS-CLI"><a href="#Cai-dat-NestJS-CLI" class="headerlink" title="Cài đặt NestJS CLI"></a>Cài đặt NestJS CLI</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Cài đặt globally</span></span><br><span class="line">npm install -g @nestjs/cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tạo project mới</span></span><br><span class="line">nest new my-nest-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hoặc với TypeScript</span></span><br><span class="line">nest new my-nest-app --package-manager npm</span><br></pre></td></tr></table></figure>

<h3 id="Cau-truc-project"><a href="#Cau-truc-project" class="headerlink" title="Cấu trúc project"></a>Cấu trúc project</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">├── app.controller.ts</span><br><span class="line">├── app.service.ts</span><br><span class="line">├── app.module.ts</span><br><span class="line">├── main.ts</span><br><span class="line">├── users/</span><br><span class="line">│   ├── dto/</span><br><span class="line">│   │   ├── create-user.dto.ts</span><br><span class="line">│   │   └── update-user.dto.ts</span><br><span class="line">│   ├── entities/</span><br><span class="line">│   │   └── user.entity.ts</span><br><span class="line">│   ├── users.controller.ts</span><br><span class="line">│   ├── users.service.ts</span><br><span class="line">│   └── users.module.ts</span><br><span class="line">└── common/</span><br><span class="line">    ├── decorators/</span><br><span class="line">    ├── filters/</span><br><span class="line">    ├── guards/</span><br><span class="line">    ├── interceptors/</span><br><span class="line">    └── pipes/</span><br></pre></td></tr></table></figure>

<h3 id="main-ts-Entry-point"><a href="#main-ts-Entry-point" class="headerlink" title="main.ts - Entry point"></a>main.ts - Entry point</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NestFactory</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ValidationPipe</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SwaggerModule</span>, <span class="title class_">DocumentBuilder</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/swagger&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.module&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> <span class="title class_">NestFactory</span>.<span class="title function_">create</span>(<span class="title class_">AppModule</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Global pipes</span></span><br><span class="line">  app.<span class="title function_">useGlobalPipes</span>(<span class="keyword">new</span> <span class="title class_">ValidationPipe</span>(&#123;</span><br><span class="line">    <span class="attr">whitelist</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">forbidNonWhitelisted</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">transform</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// CORS</span></span><br><span class="line">  app.<span class="title function_">enableCors</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Swagger documentation</span></span><br><span class="line">  <span class="keyword">const</span> config = <span class="keyword">new</span> <span class="title class_">DocumentBuilder</span>()</span><br><span class="line">    .<span class="title function_">setTitle</span>(<span class="string">&#x27;NestJS API&#x27;</span>)</span><br><span class="line">    .<span class="title function_">setDescription</span>(<span class="string">&#x27;API documentation&#x27;</span>)</span><br><span class="line">    .<span class="title function_">setVersion</span>(<span class="string">&#x27;1.0&#x27;</span>)</span><br><span class="line">    .<span class="title function_">addBearerAuth</span>()</span><br><span class="line">    .<span class="title function_">build</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">document</span> = <span class="title class_">SwaggerModule</span>.<span class="title function_">createDocument</span>(app, config);</span><br><span class="line">  <span class="title class_">SwaggerModule</span>.<span class="title function_">setup</span>(<span class="string">&#x27;api&#x27;</span>, app, <span class="variable language_">document</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">await</span> app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">bootstrap</span>();</span><br></pre></td></tr></table></figure>

<h2 id="3-Core-Concepts"><a href="#3-Core-Concepts" class="headerlink" title="3. Core Concepts"></a>3. Core Concepts</h2><h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UsersModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./users/users.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DatabaseModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./database/database.module&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">DatabaseModule</span>, <span class="title class_">UsersModule</span>],</span><br><span class="line">  <span class="attr">controllers</span>: [],</span><br><span class="line">  <span class="attr">providers</span>: [],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// users.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TypeOrmModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UsersController</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UsersService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">User</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./entities/user.entity&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">TypeOrmModule</span>.<span class="title function_">forFeature</span>([<span class="title class_">User</span>])],</span><br><span class="line">  <span class="attr">controllers</span>: [<span class="title class_">UsersController</span>],</span><br><span class="line">  <span class="attr">providers</span>: [<span class="title class_">UsersService</span>],</span><br><span class="line">  <span class="attr">exports</span>: [<span class="title class_">UsersService</span>],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UsersModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controllers"><a href="#Controllers" class="headerlink" title="Controllers"></a>Controllers</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  <span class="title class_">Controller</span>, </span><br><span class="line">  <span class="title class_">Get</span>, </span><br><span class="line">  <span class="title class_">Post</span>, </span><br><span class="line">  <span class="title class_">Put</span>, </span><br><span class="line">  <span class="title class_">Delete</span>, </span><br><span class="line">  <span class="title class_">Body</span>, </span><br><span class="line">  <span class="title class_">Param</span>, </span><br><span class="line">  <span class="title class_">Query</span>,</span><br><span class="line">  <span class="title class_">UseGuards</span>,</span><br><span class="line">  <span class="title class_">HttpCode</span>,</span><br><span class="line">  <span class="title class_">HttpStatus</span> </span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApiTags</span>, <span class="title class_">ApiOperation</span>, <span class="title class_">ApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/swagger&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UsersService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CreateUserDto</span>, <span class="title class_">UpdateUserDto</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./dto&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">JwtAuthGuard</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../auth/guards/jwt-auth.guard&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RolesGuard</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../auth/guards/roles.guard&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Roles</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../auth/decorators/roles.decorator&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiTags</span>(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"><span class="meta">@UseGuards</span>(<span class="title class_">JwtAuthGuard</span>, <span class="title class_">RolesGuard</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UsersController</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> <span class="attr">usersService</span>: <span class="title class_">UsersService</span></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  <span class="meta">@ApiOperation</span>(&#123; <span class="attr">summary</span>: <span class="string">&#x27;Get all users&#x27;</span> &#125;)</span><br><span class="line">  <span class="meta">@ApiResponse</span>(&#123; <span class="attr">status</span>: <span class="number">200</span>, <span class="attr">description</span>: <span class="string">&#x27;Return all users&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">findAll</span>(<span class="params"><span class="meta">@Query</span>() <span class="attr">query</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">findAll</span>(query);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line">  <span class="meta">@ApiOperation</span>(&#123; <span class="attr">summary</span>: <span class="string">&#x27;Get user by id&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">findOne</span>(<span class="params"><span class="meta">@Param</span>(<span class="string">&#x27;id&#x27;</span>) <span class="attr">id</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">findOne</span>(+id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Post</span>()</span><br><span class="line">  <span class="meta">@Roles</span>(<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">  <span class="meta">@ApiOperation</span>(&#123; <span class="attr">summary</span>: <span class="string">&#x27;Create new user&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"><span class="meta">@Body</span>() <span class="attr">createUserDto</span>: <span class="title class_">CreateUserDto</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">create</span>(createUserDto);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Put</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line">  <span class="meta">@Roles</span>(<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">update</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@Param</span>(<span class="string">&#x27;id&#x27;</span>) <span class="attr">id</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="meta">@Body</span>() <span class="attr">updateUserDto</span>: <span class="title class_">UpdateUserDto</span></span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">update</span>(+id, updateUserDto);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Delete</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line">  <span class="meta">@HttpCode</span>(<span class="title class_">HttpStatus</span>.<span class="property">NO_CONTENT</span>)</span><br><span class="line">  <span class="meta">@Roles</span>(<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">remove</span>(<span class="params"><span class="meta">@Param</span>(<span class="string">&#x27;id&#x27;</span>) <span class="attr">id</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">remove</span>(+id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">NotFoundException</span>, <span class="title class_">ConflictException</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">InjectRepository</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Repository</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">User</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./entities/user.entity&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CreateUserDto</span>, <span class="title class_">UpdateUserDto</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./dto&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hash &#125; <span class="keyword">from</span> <span class="string">&#x27;bcrypt&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UsersService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@InjectRepository</span>(User)</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> <span class="attr">usersRepository</span>: <span class="title class_">Repository</span>&lt;<span class="title class_">User</span>&gt;,</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">findAll</span>(<span class="attr">query</span>?: <span class="built_in">any</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>[]&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> queryBuilder = <span class="variable language_">this</span>.<span class="property">usersRepository</span>.<span class="title function_">createQueryBuilder</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (query.<span class="property">search</span>) &#123;</span><br><span class="line">      queryBuilder.<span class="title function_">where</span>(<span class="string">&#x27;user.name LIKE :search OR user.email LIKE :search&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">search</span>: <span class="string">`%<span class="subst">$&#123;query.search&#125;</span>%`</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (query.<span class="property">sort</span>) &#123;</span><br><span class="line">      queryBuilder.<span class="title function_">orderBy</span>(<span class="string">`user.<span class="subst">$&#123;query.sort&#125;</span>`</span>, query.<span class="property">order</span> || <span class="string">&#x27;ASC&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> queryBuilder.<span class="title function_">getMany</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">findOne</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">usersRepository</span>.<span class="title function_">findOne</span>(&#123; <span class="attr">where</span>: &#123; id &#125; &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotFoundException</span>(<span class="string">`User with ID <span class="subst">$&#123;id&#125;</span> not found`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">create</span>(<span class="attr">createUserDto</span>: <span class="title class_">CreateUserDto</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> existingUser = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">usersRepository</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">      <span class="attr">where</span>: &#123; <span class="attr">email</span>: createUserDto.<span class="property">email</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (existingUser) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConflictException</span>(<span class="string">&#x27;Email already exists&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hashedPassword = <span class="keyword">await</span> <span class="title function_">hash</span>(createUserDto.<span class="property">password</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">const</span> user = <span class="variable language_">this</span>.<span class="property">usersRepository</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">      ...createUserDto,</span><br><span class="line">      <span class="attr">password</span>: hashedPassword,</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersRepository</span>.<span class="title function_">save</span>(user);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">update</span>(<span class="attr">id</span>: <span class="built_in">number</span>, <span class="attr">updateUserDto</span>: <span class="title class_">UpdateUserDto</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">findOne</span>(id);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (updateUserDto.<span class="property">password</span>) &#123;</span><br><span class="line">      updateUserDto.<span class="property">password</span> = <span class="keyword">await</span> <span class="title function_">hash</span>(updateUserDto.<span class="property">password</span>, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(user, updateUserDto);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersRepository</span>.<span class="title function_">save</span>(user);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">remove</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">findOne</span>(id);</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">usersRepository</span>.<span class="title function_">remove</span>(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-DTOs-va-Validation"><a href="#4-DTOs-va-Validation" class="headerlink" title="4. DTOs và Validation"></a>4. DTOs và Validation</h2><h3 id="DTOs-Data-Transfer-Objects"><a href="#DTOs-Data-Transfer-Objects" class="headerlink" title="DTOs (Data Transfer Objects)"></a>DTOs (Data Transfer Objects)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create-user.dto.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">IsEmail</span>, <span class="title class_">IsString</span>, <span class="title class_">MinLength</span>, <span class="title class_">IsOptional</span>, <span class="title class_">IsEnum</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;class-validator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApiProperty</span>, <span class="title class_">ApiPropertyOptional</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/swagger&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">UserRole</span> &#123;</span><br><span class="line">  <span class="variable constant_">USER</span> = <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">ADMIN</span> = <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">MODERATOR</span> = <span class="string">&#x27;moderator&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">CreateUserDto</span> &#123;</span><br><span class="line">  <span class="meta">@ApiProperty</span>(&#123; <span class="attr">description</span>: <span class="string">&#x27;User name&#x27;</span> &#125;)</span><br><span class="line">  <span class="meta">@IsString</span>()</span><br><span class="line">  <span class="meta">@MinLength</span>(<span class="number">2</span>)</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiProperty</span>(&#123; <span class="attr">description</span>: <span class="string">&#x27;User email&#x27;</span> &#125;)</span><br><span class="line">  <span class="meta">@IsEmail</span>()</span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiProperty</span>(&#123; <span class="attr">description</span>: <span class="string">&#x27;User password&#x27;</span> &#125;)</span><br><span class="line">  <span class="meta">@IsString</span>()</span><br><span class="line">  <span class="meta">@MinLength</span>(<span class="number">6</span>)</span><br><span class="line">  <span class="attr">password</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiPropertyOptional</span>(&#123; <span class="attr">enum</span>: <span class="title class_">UserRole</span>, <span class="attr">default</span>: <span class="title class_">UserRole</span>.<span class="property">USER</span> &#125;)</span><br><span class="line">  <span class="meta">@IsOptional</span>()</span><br><span class="line">  <span class="meta">@IsEnum</span>(<span class="title class_">UserRole</span>)</span><br><span class="line">  <span class="attr">role</span>?: <span class="title class_">UserRole</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// update-user.dto.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PartialType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/swagger&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CreateUserDto</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./create-user.dto&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UpdateUserDto</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PartialType</span>(<span class="title class_">CreateUserDto</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Custom-Validation-Pipes"><a href="#Custom-Validation-Pipes" class="headerlink" title="Custom Validation Pipes"></a>Custom Validation Pipes</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// validation.pipe.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PipeTransform</span>, <span class="title class_">Injectable</span>, <span class="title class_">ArgumentMetadata</span>, <span class="title class_">BadRequestException</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; validate &#125; <span class="keyword">from</span> <span class="string">&#x27;class-validator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; plainToClass &#125; <span class="keyword">from</span> <span class="string">&#x27;class-transformer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ValidationPipe</span> <span class="keyword">implements</span> <span class="title class_">PipeTransform</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">transform</span>(<span class="params"><span class="attr">value</span>: <span class="built_in">any</span>, &#123; metatype &#125;: <span class="title class_">ArgumentMetadata</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!metatype || !<span class="variable language_">this</span>.<span class="title function_">toValidate</span>(metatype)) &#123;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">object</span> = <span class="title function_">plainToClass</span>(metatype, value);</span><br><span class="line">    <span class="keyword">const</span> errors = <span class="keyword">await</span> <span class="title function_">validate</span>(<span class="built_in">object</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (errors.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(<span class="string">&#x27;Validation failed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">toValidate</span>(<span class="attr">metatype</span>: <span class="title class_">Function</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">types</span>: <span class="title class_">Function</span>[] = [<span class="title class_">String</span>, <span class="title class_">Boolean</span>, <span class="title class_">Number</span>, <span class="title class_">Array</span>, <span class="title class_">Object</span>];</span><br><span class="line">    <span class="keyword">return</span> !types.<span class="title function_">includes</span>(metatype);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-Authentication-Authorization"><a href="#5-Authentication-Authorization" class="headerlink" title="5. Authentication &amp; Authorization"></a>5. Authentication &amp; Authorization</h2><h3 id="JWT-Strategy"><a href="#JWT-Strategy" class="headerlink" title="JWT Strategy"></a>JWT Strategy</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jwt.strategy.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ExtractJwt</span>, <span class="title class_">Strategy</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;passport-jwt&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PassportStrategy</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/passport&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">UnauthorizedException</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConfigService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UsersService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../users/users.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">JwtStrategy</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PassportStrategy</span>(<span class="title class_">Strategy</span>) &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> <span class="attr">configService</span>: <span class="title class_">ConfigService</span>,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> <span class="attr">usersService</span>: <span class="title class_">UsersService</span>,</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(&#123;</span><br><span class="line">      <span class="attr">jwtFromRequest</span>: <span class="title class_">ExtractJwt</span>.<span class="title function_">fromAuthHeaderAsBearerToken</span>(),</span><br><span class="line">      <span class="attr">ignoreExpiration</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">secretOrKey</span>: configService.<span class="property">get</span>&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;JWT_SECRET&#x27;</span>),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">validate</span>(<span class="params"><span class="attr">payload</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">findOne</span>(payload.<span class="property">sub</span>);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnauthorizedException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Guards"><a href="#Guards" class="headerlink" title="Guards"></a>Guards</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// roles.guard.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">CanActivate</span>, <span class="title class_">ExecutionContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Reflector</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ROLES_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../decorators/roles.decorator&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">RolesGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="attr">reflector</span>: <span class="title class_">Reflector</span></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">canActivate</span>(<span class="attr">context</span>: <span class="title class_">ExecutionContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> requiredRoles = <span class="variable language_">this</span>.<span class="property">reflector</span>.<span class="property">getAllAndOverride</span>&lt;<span class="built_in">string</span>[]&gt;(<span class="variable constant_">ROLES_KEY</span>, [</span><br><span class="line">      context.<span class="title function_">getHandler</span>(),</span><br><span class="line">      context.<span class="title function_">getClass</span>(),</span><br><span class="line">    ]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!requiredRoles) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = context.<span class="title function_">switchToHttp</span>().<span class="title function_">getRequest</span>();</span><br><span class="line">    <span class="keyword">return</span> requiredRoles.<span class="title function_">some</span>(<span class="function">(<span class="params">role</span>) =&gt;</span> user.<span class="property">roles</span>?.<span class="title function_">includes</span>(role));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// roles.decorator.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SetMetadata</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ROLES_KEY</span> = <span class="string">&#x27;roles&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Roles</span> = (<span class="params">...<span class="attr">roles</span>: <span class="built_in">string</span>[]</span>) =&gt; <span class="title class_">SetMetadata</span>(<span class="variable constant_">ROLES_KEY</span>, roles);</span><br><span class="line"></span><br><span class="line"><span class="comment">// current-user.decorator.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createParamDecorator, <span class="title class_">ExecutionContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">CurrentUser</span> = <span class="title function_">createParamDecorator</span>(</span><br><span class="line">  <span class="function">(<span class="params"><span class="attr">data</span>: <span class="built_in">unknown</span>, <span class="attr">ctx</span>: <span class="title class_">ExecutionContext</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> request = ctx.<span class="title function_">switchToHttp</span>().<span class="title function_">getRequest</span>();</span><br><span class="line">    <span class="keyword">return</span> request.<span class="property">user</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="6-Database-Integration"><a href="#6-Database-Integration" class="headerlink" title="6. Database Integration"></a>6. Database Integration</h2><h3 id="TypeORM-Configuration"><a href="#TypeORM-Configuration" class="headerlink" title="TypeORM Configuration"></a>TypeORM Configuration</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// database.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TypeOrmModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConfigModule</span>, <span class="title class_">ConfigService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">TypeOrmModule</span>.<span class="title function_">forRootAsync</span>(&#123;</span><br><span class="line">      <span class="attr">imports</span>: [<span class="title class_">ConfigModule</span>],</span><br><span class="line">      <span class="attr">useFactory</span>: <span class="function">(<span class="params"><span class="attr">configService</span>: <span class="title class_">ConfigService</span></span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">        <span class="attr">host</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;DB_HOST&#x27;</span>),</span><br><span class="line">        <span class="attr">port</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;DB_PORT&#x27;</span>),</span><br><span class="line">        <span class="attr">username</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;DB_USERNAME&#x27;</span>),</span><br><span class="line">        <span class="attr">password</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;DB_PASSWORD&#x27;</span>),</span><br><span class="line">        <span class="attr">database</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;DB_NAME&#x27;</span>),</span><br><span class="line">        <span class="attr">entities</span>: [__dirname + <span class="string">&#x27;/../**/*.entity&#123;.ts,.js&#125;&#x27;</span>],</span><br><span class="line">        <span class="attr">synchronize</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;NODE_ENV&#x27;</span>) !== <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">        <span class="attr">logging</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;NODE_ENV&#x27;</span>) === <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="attr">inject</span>: [<span class="title class_">ConfigService</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DatabaseModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.entity.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Entity</span>, <span class="title class_">PrimaryGeneratedColumn</span>, <span class="title class_">Column</span>, <span class="title class_">CreateDateColumn</span>, <span class="title class_">UpdateDateColumn</span>, <span class="title class_">BeforeInsert</span>, <span class="title class_">BeforeUpdate</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Exclude</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;class-transformer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hash &#125; <span class="keyword">from</span> <span class="string">&#x27;bcrypt&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="meta">@PrimaryGeneratedColumn</span>()</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="attr">unique</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>()</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>()</span><br><span class="line">  <span class="meta">@Exclude</span>()</span><br><span class="line">  <span class="attr">password</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;enum&#x27;</span>,</span><br><span class="line">    <span class="attr">enum</span>: [<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;moderator&#x27;</span>],</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="attr">role</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="attr">default</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="attr">isActive</span>: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CreateDateColumn</span>()</span><br><span class="line">  <span class="attr">createdAt</span>: <span class="title class_">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@UpdateDateColumn</span>()</span><br><span class="line">  <span class="attr">updatedAt</span>: <span class="title class_">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@BeforeInsert</span>()</span><br><span class="line">  <span class="meta">@BeforeUpdate</span>()</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">hashPassword</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">password</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">password</span> = <span class="keyword">await</span> <span class="title function_">hash</span>(<span class="variable language_">this</span>.<span class="property">password</span>, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-Interceptors-va-Filters"><a href="#7-Interceptors-va-Filters" class="headerlink" title="7. Interceptors và Filters"></a>7. Interceptors và Filters</h2><h3 id="Response-Interceptor"><a href="#Response-Interceptor" class="headerlink" title="Response Interceptor"></a>Response Interceptor</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// transform.interceptor.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">NestInterceptor</span>, <span class="title class_">ExecutionContext</span>, <span class="title class_">CallHandler</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Response</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T;</span><br><span class="line">  <span class="attr">statusCode</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">timestamp</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TransformInterceptor</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">NestInterceptor</span>&lt;T, <span class="title class_">Response</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="title function_">intercept</span>(<span class="attr">context</span>: <span class="title class_">ExecutionContext</span>, <span class="attr">next</span>: <span class="title class_">CallHandler</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">Response</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> next.<span class="title function_">handle</span>().<span class="title function_">pipe</span>(</span><br><span class="line">      <span class="title function_">map</span>(<span class="function"><span class="params">data</span> =&gt;</span> (&#123;</span><br><span class="line">        data,</span><br><span class="line">        <span class="attr">statusCode</span>: context.<span class="title function_">switchToHttp</span>().<span class="title function_">getResponse</span>().<span class="property">statusCode</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;Success&#x27;</span>,</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class="line">      &#125;)),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Exception-Filter"><a href="#Exception-Filter" class="headerlink" title="Exception Filter"></a>Exception Filter</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http-exception.filter.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ExceptionFilter</span>, <span class="title class_">Catch</span>, <span class="title class_">ArgumentsHost</span>, <span class="title class_">HttpException</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Request</span>, <span class="title class_">Response</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Catch</span>(<span class="title class_">HttpException</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HttpExceptionFilter</span> <span class="keyword">implements</span> <span class="title class_">ExceptionFilter</span> &#123;</span><br><span class="line">  <span class="keyword">catch</span>(<span class="attr">exception</span>: <span class="title class_">HttpException</span>, <span class="attr">host</span>: <span class="title class_">ArgumentsHost</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = host.<span class="title function_">switchToHttp</span>();</span><br><span class="line">    <span class="keyword">const</span> response = ctx.<span class="property">getResponse</span>&lt;<span class="title class_">Response</span>&gt;();</span><br><span class="line">    <span class="keyword">const</span> request = ctx.<span class="property">getRequest</span>&lt;<span class="title class_">Request</span>&gt;();</span><br><span class="line">    <span class="keyword">const</span> status = exception.<span class="title function_">getStatus</span>();</span><br><span class="line">    <span class="keyword">const</span> exceptionResponse = exception.<span class="title function_">getResponse</span>();</span><br><span class="line"></span><br><span class="line">    response.<span class="title function_">status</span>(status).<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">statusCode</span>: status,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class="line">      <span class="attr">path</span>: request.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="keyword">typeof</span> exceptionResponse === <span class="string">&#x27;string&#x27;</span> </span><br><span class="line">        ? exceptionResponse </span><br><span class="line">        : (exceptionResponse <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">message</span> || exception.<span class="property">message</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-Testing"><a href="#8-Testing" class="headerlink" title="8. Testing"></a>8. Testing</h2><h3 id="Unit-Testing"><a href="#Unit-Testing" class="headerlink" title="Unit Testing"></a>Unit Testing</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// users.service.spec.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Test</span>, <span class="title class_">TestingModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/testing&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getRepositoryToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Repository</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UsersService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">User</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./entities/user.entity&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CreateUserDto</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./dto/create-user.dto&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NotFoundException</span>, <span class="title class_">ConflictException</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;UsersService&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">service</span>: <span class="title class_">UsersService</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">repository</span>: <span class="title class_">Repository</span>&lt;<span class="title class_">User</span>&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> mockRepository = &#123;</span><br><span class="line">    <span class="attr">create</span>: jest.<span class="title function_">fn</span>(),</span><br><span class="line">    <span class="attr">save</span>: jest.<span class="title function_">fn</span>(),</span><br><span class="line">    <span class="attr">findOne</span>: jest.<span class="title function_">fn</span>(),</span><br><span class="line">    <span class="attr">find</span>: jest.<span class="title function_">fn</span>(),</span><br><span class="line">    <span class="attr">remove</span>: jest.<span class="title function_">fn</span>(),</span><br><span class="line">    <span class="attr">createQueryBuilder</span>: jest.<span class="title function_">fn</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">where</span>: jest.<span class="title function_">fn</span>().<span class="title function_">mockReturnThis</span>(),</span><br><span class="line">      <span class="attr">orderBy</span>: jest.<span class="title function_">fn</span>().<span class="title function_">mockReturnThis</span>(),</span><br><span class="line">      <span class="attr">getMany</span>: jest.<span class="title function_">fn</span>().<span class="title function_">mockResolvedValue</span>([]),</span><br><span class="line">    &#125;)),</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">module</span>: <span class="title class_">TestingModule</span> = <span class="keyword">await</span> <span class="title class_">Test</span>.<span class="title function_">createTestingModule</span>(&#123;</span><br><span class="line">      <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title class_">UsersService</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">provide</span>: <span class="title function_">getRepositoryToken</span>(<span class="title class_">User</span>),</span><br><span class="line">          <span class="attr">useValue</span>: mockRepository,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;).<span class="title function_">compile</span>();</span><br><span class="line"></span><br><span class="line">    service = <span class="variable language_">module</span>.<span class="property">get</span>&lt;<span class="title class_">UsersService</span>&gt;(<span class="title class_">UsersService</span>);</span><br><span class="line">    repository = <span class="variable language_">module</span>.<span class="property">get</span>&lt;<span class="title class_">Repository</span>&lt;<span class="title class_">User</span>&gt;&gt;(<span class="title function_">getRepositoryToken</span>(<span class="title class_">User</span>));</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should be defined&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(service).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;create&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should create a new user&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">createUserDto</span>: <span class="title class_">CreateUserDto</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&#x27;john@example.com&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;password123&#x27;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">1</span>, ...createUserDto &#125;;</span><br><span class="line">      jest.<span class="title function_">spyOn</span>(repository, <span class="string">&#x27;findOne&#x27;</span>).<span class="title function_">mockResolvedValue</span>(<span class="literal">null</span>);</span><br><span class="line">      jest.<span class="title function_">spyOn</span>(repository, <span class="string">&#x27;create&#x27;</span>).<span class="title function_">mockReturnValue</span>(user);</span><br><span class="line">      jest.<span class="title function_">spyOn</span>(repository, <span class="string">&#x27;save&#x27;</span>).<span class="title function_">mockResolvedValue</span>(user);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> service.<span class="title function_">create</span>(createUserDto);</span><br><span class="line">      <span class="title function_">expect</span>(result).<span class="title function_">toEqual</span>(user);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should throw ConflictException if email exists&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">createUserDto</span>: <span class="title class_">CreateUserDto</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&#x27;john@example.com&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;password123&#x27;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      jest.<span class="title function_">spyOn</span>(repository, <span class="string">&#x27;findOne&#x27;</span>).<span class="title function_">mockResolvedValue</span>(&#123;&#125; <span class="keyword">as</span> <span class="title class_">User</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">expect</span>(service.<span class="title function_">create</span>(createUserDto)).<span class="property">rejects</span>.<span class="title function_">toThrow</span>(<span class="title class_">ConflictException</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;findOne&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should return a user&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;john@example.com&#x27;</span> &#125;;</span><br><span class="line">      jest.<span class="title function_">spyOn</span>(repository, <span class="string">&#x27;findOne&#x27;</span>).<span class="title function_">mockResolvedValue</span>(user <span class="keyword">as</span> <span class="title class_">User</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> service.<span class="title function_">findOne</span>(<span class="number">1</span>);</span><br><span class="line">      <span class="title function_">expect</span>(result).<span class="title function_">toEqual</span>(user);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should throw NotFoundException if user not found&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      jest.<span class="title function_">spyOn</span>(repository, <span class="string">&#x27;findOne&#x27;</span>).<span class="title function_">mockResolvedValue</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">expect</span>(service.<span class="title function_">findOne</span>(<span class="number">1</span>)).<span class="property">rejects</span>.<span class="title function_">toThrow</span>(<span class="title class_">NotFoundException</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="E2E-Testing"><a href="#E2E-Testing" class="headerlink" title="E2E Testing"></a>E2E Testing</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// users.e2e-spec.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Test</span>, <span class="title class_">TestingModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/testing&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">INestApplication</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> request <span class="keyword">from</span> <span class="string">&#x27;supertest&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../src/app.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TypeOrmModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;UsersController (e2e)&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">app</span>: <span class="title class_">INestApplication</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">moduleFixture</span>: <span class="title class_">TestingModule</span> = <span class="keyword">await</span> <span class="title class_">Test</span>.<span class="title function_">createTestingModule</span>(&#123;</span><br><span class="line">      <span class="attr">imports</span>: [</span><br><span class="line">        <span class="title class_">AppModule</span>,</span><br><span class="line">        <span class="title class_">TypeOrmModule</span>.<span class="title function_">forRoot</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;sqlite&#x27;</span>,</span><br><span class="line">          <span class="attr">database</span>: <span class="string">&#x27;:memory:&#x27;</span>,</span><br><span class="line">          <span class="attr">entities</span>: [__dirname + <span class="string">&#x27;/../**/*.entity&#123;.ts,.js&#125;&#x27;</span>],</span><br><span class="line">          <span class="attr">synchronize</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">      ],</span><br><span class="line">    &#125;).<span class="title function_">compile</span>();</span><br><span class="line"></span><br><span class="line">    app = moduleFixture.<span class="title function_">createNestApplication</span>();</span><br><span class="line">    <span class="keyword">await</span> app.<span class="title function_">init</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">afterAll</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> app.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;/users (GET)&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(app.<span class="title function_">getHttpServer</span>())</span><br><span class="line">      .<span class="title function_">get</span>(<span class="string">&#x27;/users&#x27;</span>)</span><br><span class="line">      .<span class="title function_">expect</span>(<span class="number">200</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;/users (POST)&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(app.<span class="title function_">getHttpServer</span>())</span><br><span class="line">      .<span class="title function_">post</span>(<span class="string">&#x27;/users&#x27;</span>)</span><br><span class="line">      .<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&#x27;john@example.com&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;password123&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">expect</span>(<span class="number">201</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="9-Configuration-Management"><a href="#9-Configuration-Management" class="headerlink" title="9. Configuration Management"></a>9. Configuration Management</h2><h3 id="Environment-Configuration"><a href="#Environment-Configuration" class="headerlink" title="Environment Configuration"></a>Environment Configuration</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/configuration.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="title function_">default</span> () =&gt; (&#123;</span><br><span class="line">  <span class="attr">port</span>: <span class="built_in">parseInt</span>(process.<span class="property">env</span>.<span class="property">PORT</span>, <span class="number">10</span>) || <span class="number">3000</span>,</span><br><span class="line">  <span class="attr">database</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: process.<span class="property">env</span>.<span class="property">DB_HOST</span> || <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="built_in">parseInt</span>(process.<span class="property">env</span>.<span class="property">DB_PORT</span>, <span class="number">10</span>) || <span class="number">5432</span>,</span><br><span class="line">    <span class="attr">username</span>: process.<span class="property">env</span>.<span class="property">DB_USERNAME</span> || <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: process.<span class="property">env</span>.<span class="property">DB_PASSWORD</span> || <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">    <span class="attr">database</span>: process.<span class="property">env</span>.<span class="property">DB_NAME</span> || <span class="string">&#x27;nestjs&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">jwt</span>: &#123;</span><br><span class="line">    <span class="attr">secret</span>: process.<span class="property">env</span>.<span class="property">JWT_SECRET</span> || <span class="string">&#x27;secret&#x27;</span>,</span><br><span class="line">    <span class="attr">expiresIn</span>: process.<span class="property">env</span>.<span class="property">JWT_EXPIRES_IN</span> || <span class="string">&#x27;1d&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">redis</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: process.<span class="property">env</span>.<span class="property">REDIS_HOST</span> || <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="built_in">parseInt</span>(process.<span class="property">env</span>.<span class="property">REDIS_PORT</span>, <span class="number">10</span>) || <span class="number">6379</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConfigModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> configuration <span class="keyword">from</span> <span class="string">&#x27;./config/configuration&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">ConfigModule</span>.<span class="title function_">forRoot</span>(&#123;</span><br><span class="line">      <span class="attr">isGlobal</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">load</span>: [configuration],</span><br><span class="line">      <span class="attr">envFilePath</span>: [<span class="string">&#x27;.env.local&#x27;</span>, <span class="string">&#x27;.env&#x27;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-Microservices"><a href="#10-Microservices" class="headerlink" title="10. Microservices"></a>10. Microservices</h2><h3 id="TCP-Microservice"><a href="#TCP-Microservice" class="headerlink" title="TCP Microservice"></a>TCP Microservice</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NestFactory</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Transport</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/microservices&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.module&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> <span class="title class_">NestFactory</span>.<span class="title function_">createMicroservice</span>(<span class="title class_">AppModule</span>, &#123;</span><br><span class="line">    <span class="attr">transport</span>: <span class="title class_">Transport</span>.<span class="property">TCP</span>,</span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">      <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">      <span class="attr">port</span>: <span class="number">3001</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> app.<span class="title function_">listen</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">bootstrap</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// users.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Controller</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MessagePattern</span>, <span class="title class_">Payload</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/microservices&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UsersService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">UsersController</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> <span class="attr">usersService</span>: <span class="title class_">UsersService</span></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@MessagePattern</span>(&#123; <span class="attr">cmd</span>: <span class="string">&#x27;findAll&#x27;</span> &#125;)</span><br><span class="line">  <span class="title function_">findAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">findAll</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@MessagePattern</span>(&#123; <span class="attr">cmd</span>: <span class="string">&#x27;findOne&#x27;</span> &#125;)</span><br><span class="line">  <span class="title function_">findOne</span>(<span class="params"><span class="meta">@Payload</span>() <span class="attr">data</span>: &#123; id: <span class="built_in">number</span> &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">findOne</span>(data.<span class="property">id</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@MessagePattern</span>(&#123; <span class="attr">cmd</span>: <span class="string">&#x27;create&#x27;</span> &#125;)</span><br><span class="line">  <span class="title function_">create</span>(<span class="params"><span class="meta">@Payload</span>() <span class="attr">data</span>: <span class="title class_">CreateUserDto</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">usersService</span>.<span class="title function_">create</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Vi-du-thuc-te-E-commerce-API"><a href="#Vi-du-thuc-te-E-commerce-API" class="headerlink" title="Ví dụ thực tế: E-commerce API"></a>Ví dụ thực tế: E-commerce API</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// products.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TypeOrmModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ProductsController</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./products.controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ProductsService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./products.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Product</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./entities/product.entity&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Category</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./entities/category.entity&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">TypeOrmModule</span>.<span class="title function_">forFeature</span>([<span class="title class_">Product</span>, <span class="title class_">Category</span>])],</span><br><span class="line">  <span class="attr">controllers</span>: [<span class="title class_">ProductsController</span>],</span><br><span class="line">  <span class="attr">providers</span>: [<span class="title class_">ProductsService</span>],</span><br><span class="line">  <span class="attr">exports</span>: [<span class="title class_">ProductsService</span>],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ProductsModule</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// orders.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TypeOrmModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OrdersController</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./orders.controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OrdersService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./orders.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Order</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./entities/order.entity&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OrderItem</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./entities/order-item.entity&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ProductsModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../products/products.module&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">TypeOrmModule</span>.<span class="title function_">forFeature</span>([<span class="title class_">Order</span>, <span class="title class_">OrderItem</span>]),</span><br><span class="line">    <span class="title class_">ProductsModule</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">controllers</span>: [<span class="title class_">OrdersController</span>],</span><br><span class="line">  <span class="attr">providers</span>: [<span class="title class_">OrdersService</span>],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">OrdersModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>NestJS cung cấp kiến trúc enterprise-grade cho Node.js applications. Với TypeScript, dependency injection, và modular design, nó giúp xây dựng các ứng dụng scalable và maintainable.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Vui lòng kích hoạt JavaScript để xem các bình luận.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Trang chủ</a></li>
        
          <li><a href="/about/">Giới thiệu</a></li>
        
          <li><a href="/archives/">Bài viết</a></li>
        
          <li><a href="https://github.com/ph4n4n">Dự án</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Zero-to-Hero-NestJS-Enterprise-Framework-cho-Node-js"><span class="toc-number">1.</span> <span class="toc-text">Zero to Hero: NestJS - Enterprise Framework cho Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Tai-sao-chon-NestJS"><span class="toc-number">1.1.</span> <span class="toc-text">1. Tại sao chọn NestJS?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#So-sanh-voi-Express-js"><span class="toc-number">1.1.1.</span> <span class="toc-text">So sánh với Express.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Loi-ich-cua-NestJS"><span class="toc-number">1.1.2.</span> <span class="toc-text">Lợi ích của NestJS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Cai-dat-va-Setup"><span class="toc-number">1.2.</span> <span class="toc-text">2. Cài đặt và Setup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cai-dat-NestJS-CLI"><span class="toc-number">1.2.1.</span> <span class="toc-text">Cài đặt NestJS CLI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cau-truc-project"><span class="toc-number">1.2.2.</span> <span class="toc-text">Cấu trúc project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-ts-Entry-point"><span class="toc-number">1.2.3.</span> <span class="toc-text">main.ts - Entry point</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Core-Concepts"><span class="toc-number">1.3.</span> <span class="toc-text">3. Core Concepts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Modules"><span class="toc-number">1.3.1.</span> <span class="toc-text">Modules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Controllers"><span class="toc-number">1.3.2.</span> <span class="toc-text">Controllers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Services"><span class="toc-number">1.3.3.</span> <span class="toc-text">Services</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-DTOs-va-Validation"><span class="toc-number">1.4.</span> <span class="toc-text">4. DTOs và Validation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DTOs-Data-Transfer-Objects"><span class="toc-number">1.4.1.</span> <span class="toc-text">DTOs (Data Transfer Objects)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Validation-Pipes"><span class="toc-number">1.4.2.</span> <span class="toc-text">Custom Validation Pipes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Authentication-Authorization"><span class="toc-number">1.5.</span> <span class="toc-text">5. Authentication &amp; Authorization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT-Strategy"><span class="toc-number">1.5.1.</span> <span class="toc-text">JWT Strategy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Guards"><span class="toc-number">1.5.2.</span> <span class="toc-text">Guards</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decorators"><span class="toc-number">1.5.3.</span> <span class="toc-text">Decorators</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Database-Integration"><span class="toc-number">1.6.</span> <span class="toc-text">6. Database Integration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeORM-Configuration"><span class="toc-number">1.6.1.</span> <span class="toc-text">TypeORM Configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Entity"><span class="toc-number">1.6.2.</span> <span class="toc-text">Entity</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Interceptors-va-Filters"><span class="toc-number">1.7.</span> <span class="toc-text">7. Interceptors và Filters</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Response-Interceptor"><span class="toc-number">1.7.1.</span> <span class="toc-text">Response Interceptor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exception-Filter"><span class="toc-number">1.7.2.</span> <span class="toc-text">Exception Filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Testing"><span class="toc-number">1.8.</span> <span class="toc-text">8. Testing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unit-Testing"><span class="toc-number">1.8.1.</span> <span class="toc-text">Unit Testing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E2E-Testing"><span class="toc-number">1.8.2.</span> <span class="toc-text">E2E Testing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Configuration-Management"><span class="toc-number">1.9.</span> <span class="toc-text">9. Configuration Management</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Environment-Configuration"><span class="toc-number">1.9.1.</span> <span class="toc-text">Environment Configuration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Microservices"><span class="toc-number">1.10.</span> <span class="toc-text">10. Microservices</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-Microservice"><span class="toc-number">1.10.1.</span> <span class="toc-text">TCP Microservice</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vi-du-thuc-te-E-commerce-API"><span class="toc-number">1.11.</span> <span class="toc-text">Ví dụ thực tế: E-commerce API</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&text=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&is_video=false&description=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Zero to Hero: NestJS - Enterprise Framework Cho Node.js&body=Check out this article: https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&title=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&name=Zero to Hero: NestJS - Enterprise Framework Cho Node.js&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://ph4n4n.github.io/2025/01/27/Zero-to-hero-NestJS/&t=Zero to Hero: NestJS - Enterprise Framework Cho Node.js"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Chia sẻ</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Về đầu trang</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Bản quyền &copy;
    
    
    2018-2025
    ph4n4n
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Trang chủ</a></li><!--
     --><!--
       --><li><a href="/about/">Giới thiệu</a></li><!--
     --><!--
       --><li><a href="/archives/">Bài viết</a></li><!--
     --><!--
       --><li><a href="https://github.com/ph4n4n">Dự án</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'https-ph4n4n-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->


<script>
(function() {
  var fallbackQuotes = [
    {q: 'Stay hungry, stay foolish.', a: 'Steve Jobs'},
    {q: 'Không có thành công nào mà không phải trả giá.', a: 'Ẩn danh'},
    {q: 'Simplicity is the soul of efficiency.', a: 'Austin Freeman'},
    {q: 'Hãy kiên trì, mọi thứ rồi sẽ ổn.', a: 'Ẩn danh'},
    {q: 'Code is like humor. When you have to explain it, it\'s bad.', a: 'Cory House'},
    {q: 'Chỉ cần bạn không dừng lại thì việc bạn tiến chậm cũng không là vấn đề.', a: 'Khổng Tử'},
    {q: 'The best way to get started is to quit talking and begin doing.', a: 'Walt Disney'},
    {q: 'Muốn đi nhanh thì đi một mình, muốn đi xa thì đi cùng nhau.', a: 'Tục ngữ'},
    {q: 'First, solve the problem. Then, write the code.', a: 'John Johnson'},
    {q: 'Đừng sợ thất bại, hãy sợ không thử.', a: 'Ẩn danh'},
    {q: 'No code no bug, no bug no life.', a: 'ph4n4n'},
    {q: 'No code no bug, no code no food.', a: 'ph4n4n'},
    {q: 'The only way to do great work is to love what you do.', a: 'Steve Jobs'},
    {q: 'Je suis món ennemi.', a: 'ph4n4n'},
    {q: 'Chết không phải lúc trái tim ngừng đập, chết là khi ý chí ngừng tiến lên.', a: 'ChatGPT'},
  ];
  var el = document.getElementById('random-quote');
  function showQuote(q, a) {
    if (el) el.innerHTML = q + (a ? ' <span style="font-size:0.95em;color:#888;">– ' + a + '</span>' : '');
  }
  function showFallback() {
    var r = fallbackQuotes[Math.floor(Math.random() * fallbackQuotes.length)];
    showQuote(r.q, r.a);
  }
  fetch('https://zenquotes.io/api/random')
    .then(function(res) { return res.ok ? res.json() : Promise.reject(); })
    .then(function(data) {
      if (Array.isArray(data) && data[0] && data[0].q) {
        showQuote(data[0].q, data[0].a);
      } else {
        showFallback();
      }
    })
    .catch(showFallback);
})();
</script>
</body>
</html>
